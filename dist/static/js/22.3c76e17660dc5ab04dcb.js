webpackJsonp([22],{Pexu:function(t,e){},xPKH:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("mvHQ"),n=a.n(i),s={data:function(){var t=this;return{username:"",phone:null,id:null,reg_type:"",registrationRouteList:[],columns1:[{title:"用户编号",key:"id",align:"center"},{title:"姓名",slot:"name",align:"center"},{title:"手机号",key:"phone",align:"center"},{title:"注册日期",key:"created_at",align:"center",render:function(t,e){return t("div",e.row.created_at.substr(0,10))}},{title:"注册途径",key:"reg_type_name",align:"center"},{title:"消费次数",key:"consume_times",align:"center"},{title:"最近消费日期",key:"last_pay_time",align:"center"},{title:"操作",width:150,slot:"action",align:"center"}],data1:[],detailModal:!1,voucherModal:!1,columns2:[{title:"",align:"center",type:"selection"},{title:"券类编码",key:"id",align:"center"},{title:"券名称",slot:"name",align:"center"},{title:"有效天",key:"validity_day",align:"center"},{title:"数量",render:function(e,a){return e("div",[e("InputNumber",{props:{min:0,value:a.row.couponNum},on:{"on-change":function(e){a.row.couponNum=e,t.data2[a.index]=a.row,t.voucherSelect.forEach(function(e,i){e.id==a.row.id&&t.voucherSelect.splice(i,1,a.row)})}}})])}}],data2:[],coupon_num:1,page:1,pagesize:10,total:0,voucherName:"",voucherItem:{},voucherSelect:[],detailInfo:{}}},components:{},created:function(){},mounted:function(){this.getUserList(),this.getRegList()},watch:{$route:"getQuery"},methods:{getRegList:function(){var t=this;this.$fetch("/admin/index/select-member-regtype").then(function(e){if(200==e.code){console.log(e.data);var a=[];e.data.map(function(t,e){a.push({value:e,label:t})}),t.registrationRouteList=a}else t.$Message.warning(e.error)}).catch(function(e){t.$Spin.hide()})},selectRegistrationRoute:function(t){this.reg_type=t},getUserList:function(t){var e=this;"page"!==t&&(this.page=1);var a={page:this.page,pagesize:this.pagesize,phone:this.phone||"",username:this.username||"",id:this.id||"",reg_type:this.reg_type};this.$fetch("/admin/member/list",a).then(function(t){if(e.$Spin.hide(),200===t.code){console.log(t);var a=t.data.data;e.data1=a,e.total=t.data.total}else e.$Message.warning(t.error)}).catch(function(t){e.$Spin.hide()})},clearSerach:function(){this.id="",this.username="",this.phone="",this.reg_type="",this.getUserList()},getQuery:function(){var t=this;this.$route.query.id?(console.log("路由有变化",this.$route.query.id),this.voucherModal=!0,this.detailModal=!1,this.getCouponList(),this.$fetch("/admin/member/detail",{uid:this.$route.query.id}).then(function(e){200==e.code?(e.data.username?t.voucherName=e.data.username+"("+e.data.nickname+")":t.voucherName="("+e.data.nickname+")",t.voucherItem.id=t.$route.query.id):t.$Message.warning(e.error)}).catch(function(e){t.$Spin.hide()})):console.log("路由无变化")},detail:function(t){var e=this;this.detailModal=!0,this.$fetch("/admin/member/detail",{uid:t.id}).then(function(t){console.log(t),200==t.code?e.detailInfo=t.data:e.$Message.warning(t.error)}).catch(function(t){e.$Spin.hide()}),this.$router.push({name:"userCoupon",params:{id:t.id}})},getCouponList:function(){var t=this;this.$fetch("/admin/coupon/list",{page:1,page_size:100,status:-1,route_id:0}).then(function(e){if(200==e.code){var a=e.data.ret;a.forEach(function(t){t.couponNum=0}),t.data2=a}else t.$Message.warning(e.error)}).catch(function(e){t.$Spin.hide()})},voucher:function(t){this.voucherItem=t,this.voucherModal=!0,console.log(t),t.username?(console.log(t.username),this.voucherName=t.username+"("+t.nickname+")"):this.voucherName="("+t.nickname+")",this.getCouponList()},voucherOk:function(){var t=this;console.log(111),console.log(this.voucherItem);var e=this.voucherItem.id;if(this.voucherSelect.length>=1){var a=!1;if(this.voucherSelect.map(function(e){e.couponNum>0?a=!0:(t.$Message.error("请填写数量"),a=!1)}),a){console.log(222);var i=[];this.voucherSelect.map(function(t){return{id:t.id,couponNum:t.couponNum}}).map(function(t,e){i.push({couponid:t.id,num:t.couponNum})}),this.$post("/admin/coupon/grant",{uid:e,coupon:n()(i)}).then(function(e){200==e.code?(t.$Message.info("赠送优惠卷成功"),t.voucherModal=!1):(t.$Message.warning(e.error),t.voucherModal=!0)}).catch(function(e){t.$Spin.hide()})}}else this.$Message.error("请勾选赠送的优惠卷"),this.voucherModal=!0},select:function(t){console.log(t),this.voucherSelect=t},voucherCancel:function(){this.voucherModal=!1},detailCancel:function(){this.$router.push({path:"/userCenter"})},changePage:function(t){this.page=t,this.getUserList("page")}}},o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"userCenter"},[a("div",{staticClass:"new_site"},[a("div",{staticClass:"inputMsg"},[a("Input",{staticStyle:{width:"120px","margin-right":"20px"},attrs:{type:"text",placeholder:"用户姓名"},model:{value:t.username,callback:function(e){t.username=e},expression:"username"}}),t._v(" "),a("Input",{staticStyle:{width:"120px","margin-right":"20px"},attrs:{placeholder:"手机号码"},model:{value:t.phone,callback:function(e){t.phone=e},expression:"phone"}}),t._v(" "),a("Input",{staticStyle:{width:"120px","margin-right":"20px"},attrs:{type:"number",placeholder:"用户编号"},model:{value:t.id,callback:function(e){t.id=e},expression:"id"}}),t._v(" "),a("Select",{staticStyle:{width:"120px"},attrs:{placeholder:"注册途径"},on:{"on-change":t.selectRegistrationRoute},model:{value:t.reg_type,callback:function(e){t.reg_type=e},expression:"reg_type"}},t._l(t.registrationRouteList,function(e){return a("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}),1)],1),t._v(" "),a("div",{staticClass:"btns"},[a("Button",{attrs:{type:"primary"},on:{click:t.getUserList}},[t._v("搜索")]),t._v(" "),a("Button",{attrs:{type:"error"},on:{click:t.clearSerach}},[t._v("清空")])],1)]),t._v(" "),a("Table",{attrs:{columns:t.columns1,data:t.data1,border:""},scopedSlots:t._u([{key:"name",fn:function(e){var a=e.row;return e.index,[t._v(t._s(a.username)+"("+t._s(a.nickname)+")")]}},{key:"action",fn:function(e){var i=e.row;return e.index,[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(e){return t.detail(i)}}},[t._v("详情")]),t._v(" "),a("Button",{attrs:{type:"success",size:"small"},on:{click:function(e){return t.voucher(i)}}},[t._v("发券")])]}}])}),t._v(" "),a("Modal",{attrs:{title:"发券",styles:{width:"800px"}},model:{value:t.voucherModal,callback:function(e){t.voucherModal=e},expression:"voucherModal"}},[a("div",{model:{value:t.voucherItem,callback:function(e){t.voucherItem=e},expression:"voucherItem"}},[a("h2",[t._v(t._s(t.voucherName))]),t._v(" "),a("div",{staticStyle:{"margin-top":"10px"}},[a("Table",{attrs:{columns:t.columns2,data:t.data2,border:""},on:{"on-selection-change":t.select},scopedSlots:t._u([{key:"name",fn:function(e){var a=e.row;return[t._v(t._s(a.money/100)+"元优惠券")]}}])})],1)]),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"text",size:"large"},on:{click:t.voucherCancel}},[t._v("取消")]),t._v(" "),a("Button",{attrs:{type:"primary",size:"large"},on:{click:t.voucherOk}},[t._v("赠送")])],1)]),t._v(" "),a("Modal",{attrs:{title:"用户信息",styles:{width:"1000px"}},on:{"on-cancel":t.detailCancel,"on-ok":t.detailCancel},model:{value:t.detailModal,callback:function(e){t.detailModal=e},expression:"detailModal"}},[a("div",{staticClass:"head",model:{value:t.detailInfo,callback:function(e){t.detailInfo=e},expression:"detailInfo"}},[a("div",{staticClass:"avatar"},[a("img",{attrs:{src:t.detailInfo.avatar_image,alt:""}})]),t._v(" "),a("div",{staticClass:"info"},[a("div",{staticClass:"name"},[t._v(t._s(t.detailInfo.username)+"("+t._s(t.detailInfo.nickname)+")")]),t._v(" "),a("div",{staticClass:"info_detail"},[a("div",[t._v("\n            用户编号:\n            "),a("span",[t._v(t._s(t.detailInfo.id))])]),t._v(" "),a("div",{staticClass:"padleft"},[t._v("\n            手机号码:\n            "),a("span",[t._v(t._s(t.detailInfo.phone))])]),t._v(" "),a("div",{staticClass:"padleft"},[t._v("\n            身份证号:\n            "),a("span",[t._v(t._s(t.detailInfo.id_card_number))])]),t._v(" "),a("div",{staticClass:"padleft"},[t._v("\n            生日:\n            "),a("span",[t._v(t._s(t.detailInfo.birthday))])]),t._v(" "),a("div",{staticClass:"padleft"},[t._v("\n            所属区域:\n            "),a("span",[t._v(t._s(t.detailInfo.province)+t._s(t.detailInfo.city))])]),t._v(" "),a("div",{staticClass:"padleft"},[t._v("\n            注册日期:\n            "),a("span",[t._v(t._s(t.detailInfo.created_at))])]),t._v(" "),a("div",{staticClass:"padleft",staticStyle:{"border-right":"none"}},[t._v("\n            注册途径:\n            "),a("span",[t._v(t._s(t.detailInfo.reg_type_name))])])])])]),t._v(" "),a("div",{staticClass:"modal_center"},[a("div",{staticClass:"center_item"},[a("div",{staticClass:"title"},[t._v("消费次数(次)")]),t._v(" "),a("div",[t._v(t._s(t.detailInfo.consume_times))])]),t._v(" "),a("div",{staticClass:"center_item"},[a("div",{staticClass:"title"},[t._v("消费总金额(元)")]),t._v(" "),a("div",[t._v(t._s((Number(t.detailInfo.consume_sum)/100).toFixed(2)))])]),t._v(" "),a("div",{staticClass:"center_item"},[a("div",{staticClass:"title"},[t._v("最近消费日期")]),t._v(" "),a("div",[t._v(t._s(t.detailInfo.last_pay_time))])]),t._v(" "),a("div",{staticClass:"center_item"},[a("div",{staticClass:"title"},[t._v("推荐次数(次)")]),t._v(" "),a("div",[t._v(t._s(t.detailInfo.recommend_times))])]),t._v(" "),a("div",{staticClass:"center_item"},[a("div",{staticClass:"title"},[t._v("推荐成功人数(数)")]),t._v(" "),a("div",[t._v(t._s(t.detailInfo.recommend_member))])]),t._v(" "),a("div",{staticClass:"center_item"},[a("div",{staticClass:"title"},[t._v("推荐转换人数")]),t._v(" "),a("div",[t._v(t._s(t.detailInfo.recommend_pay))])]),t._v(" "),a("div",{staticClass:"center_item"},[a("div",{staticClass:"title"},[t._v("被推荐人")]),t._v(" "),a("div",[t._v(t._s(t.detailInfo.recommend_uid))])])]),t._v(" "),a("div",{staticClass:"tav_content"},[t.detailInfo.id?a("ul",{staticClass:"tav_title"},[a("li",[a("router-link",{staticClass:"tag_item",attrs:{to:{name:"userCoupon",params:{id:t.detailInfo.id}},tag:"div"}},[a("span",{staticClass:"tab_link"},[t._v("优惠卷")])])],1),t._v(" "),a("li",[a("router-link",{staticClass:"tag_item",attrs:{to:{name:"orderHistory",params:{id:t.detailInfo.id}},tag:"div"}},[a("span",{staticClass:"tab_link"},[t._v("订单记录")])])],1),t._v(" "),a("li",[a("router-link",{staticClass:"tag_item",attrs:{to:{name:"commonAddress",params:{id:t.detailInfo.id}},tag:"div"}},[a("span",{staticClass:"tab_link"},[t._v("常用地址")])])],1)]):t._e(),t._v(" "),a("div",{staticClass:"route_class"},[a("router-view")],1)])]),t._v(" "),a("div",{staticClass:"page_box"},[a("div",{staticClass:"page_left"},[t._v("\n      共"+t._s(t.total)+"条记录 第"+t._s(t.page)+"/"+t._s(Math.ceil(t.total/t.pagesize))+"页\n    ")]),t._v(" "),a("div",{staticClass:"page_right"},[a("Page",{attrs:{total:t.total,"page-size":t.pagesize,current:t.page},on:{"on-change":t.changePage}})],1)])],1)},staticRenderFns:[]};var r=a("VU/8")(s,o,!1,function(t){a("Pexu")},"data-v-bd2bdc70",null);e.default=r.exports}});
//# sourceMappingURL=22.3c76e17660dc5ab04dcb.js.map