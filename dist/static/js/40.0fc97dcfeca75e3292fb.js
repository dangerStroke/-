webpackJsonp([40],{SEp2:function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});e("P9l9"),e("YW59");var a=e("mtWM"),i=e.n(a),l={data:function(){return{page:1,pagesize:10,columns:[{title:"操作",slot:"action",align:"center",width:300},{type:"index",title:"序号",width:80,align:"center"},{title:"订单状态",slot:"status",width:120},{title:"订单编号",key:"order_sn",width:180},{title:"预订人",key:"name",width:160},{title:"预订人电话",key:"phone",width:160},{title:"直通车项目",key:"title",width:200},{title:"门票信息",slot:"ticket",width:100},{title:"车辆",key:"plate_no",width:100},{title:"司机",key:"driver",width:100},{title:"发车时间",key:"date",width:180},{title:"订单创建时间",key:"created_at",width:180}],listData:[],total:0,refundId:"",cancleId:"",changeType:"",orderId:"",uid:"",modalText:"您确定要删除选中项目吗？",showModal:!1,status:"",order_sn:"",date:"",statusArr:[{label:"待支付",value:1},{label:"已支付",value:2},{label:"已取消",value:3},{label:"支付失败",value:4},{label:"已完成",value:5},{label:"已评价",value:6},{label:"已退款",value:7},{label:"退款中",value:8}],showDetail:!1,detailInfo:{},priceData:[],priceColum:[{title:"类目",key:"title"},{title:"金额",key:"price"}],userColum:[{title:"姓名",key:"name"},{title:"身份证号",key:"id_card_number"}],userData:[],carList:[]}},created:function(){this.getOrderList(""),this.getCarList()},methods:{bindCar:function(){var t=this;if(this.detailInfo.car_id){var s={order_sn:this.detailInfo.order_sn,car_id:this.detailInfo.car_id};this.$post("/admin/throughtrain/attach-car",s).then(function(s){200===s.code&&s.data?(t.$Message.success("指派车辆成功"),t.closeDeatil(),t.getOrderList("")):t.$Message.warning(s.error)})}else this.$Message.warning("请选择指派的车辆")},closeDeatil:function(){this.showDetail=!1,this.detailInfo={}},getCarList:function(){var t=this;this.$fetch("/admin/index/select-throughtrain-car").then(function(s){if(200===s.code){var e=[];if(s.data){var a=s.data;for(var i in a){var l={value:i,label:a[i]};e.push(l)}}t.carList=e}})},countPrice:function(){var t=(new Date).getTime(),s=0;s=new Date("2020-08-10 23:59:59").getTime()-t>0?4500:9e3;var e=this.detailInfo.price-s*this.detailInfo.num,a=[{title:this.detailInfo.title,price:(e/100).toFixed(2)},{title:"海螺沟门票",price:(s*this.detailInfo.num/100).toFixed(2)},{title:"总计",price:(this.detailInfo.price/100).toFixed(2)}];this.priceData=a,this.detailInfo.priceStr=(this.detailInfo.price/100).toFixed(2)},getuserData:function(){console.log(this.detailInfo),0!=this.detailInfo.cancel_time&&(this.detailInfo.cancel_time=new Date(1e3*this.detailInfo.cancel_time).toLocaleDateString().replace(/\//g,"-")+" "+new Date(1e3*this.detailInfo.cancel_time).toTimeString().substr(0,8));var t=JSON.parse(this.detailInfo.addon);this.userData=t},bindDetail:function(t){this.detailInfo=t,this.showDetail=!0,this.countPrice(),this.getuserData()},initData:function(){this.status="",this.orderId="",this.date="",this.getOrderList("")},dateChange:function(t){this.date=t},bindConfirm:function(){var t=this,s=this.order_sn,e=this.uid,a=this.changeType,i={},l="",n="";"cancleId"===a?(i={order_sn:s},l="/admin/throughtrain/cancel",n="取消成功"):"refundId"===a?(i={order_sn:s,uid:e},l="/admin/throughtrain/refund",n="退款成功"):(i.order_sn=s,l="/admin/throughtrain/complete",n="操作成功"),"completeId"!==a?this.$fetch(l,i).then(function(s){t.modalChange("","cancle",{}),t.getOrderList(""),200===s.code?t.$Message.success(n):t.$Message.warning(s.error)}):this.$post(l,i).then(function(s){t.modalChange("","cancle",{}),t.getOrderList(""),200===s.code?s.data?t.$Message.success(n):t.$Message.warning("操作失败"):t.$Message.warning(s.error)})},modalChange:function(t,s,e){"show"===s?(this.changeType=t,this.order_sn=e.order_sn,this.uid=e.uid,this.showModal=!0):(this.showModal=!1,this.order_sn="",this.uid="",this.changeType="")},changePage:function(t){this.page=t,this.getOrderList("page")},getOrderList:function(t){var s=this;"page"!==t&&(this.page=1);var e=this.page,a=this.pagesize,i=this.status,l=this.orderId,n={page:e,pagesize:a,status:i,date:this.date};n.order_sn=l,this.$fetch("/admin/throughtrain/list-order",n).then(function(t){200===t.code?(s.listData=t.data.data,s.total=t.data.total):s.$Message.warning(t.error)})},subExcel:function(){this.page,this.pagesize;var t=this.status,s=(this.orderId,{page:1,pagesize:999999,status:t,date:this.date}),e=window.location.host,a="";a="localhost:8080"==e||"dev-admin.jd-gz.com"==e?"http://dev.jd-gz.com/admin/throughtrain/list-order-excel":"admin.jd-gz.com"==e?"http://api.jd-gz.com/admin/throughtrain/list-order-excel":"http://adminlocal/admin/throughtrain/list-order-excel",i.a.get(a,{params:s,responseType:"blob"}).then(function(t){var s=t.data,e=new FileReader;e.readAsDataURL(s),e.onload=function(t){var s=document.createElement("a");s.download="直通车订单报表.xls",s.href=t.target.result,document.body.appendChild(s),s.click(),document.body.removeChild(s)}}).catch(function(t){console.log(t.message)})}}},n={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"throughOrder"},[e("div",{staticClass:"search_box"},[e("div",{staticClass:"search_left"},[e("div",{staticClass:"search_single"},[e("Input",{staticStyle:{width:"180px"},attrs:{placeholder:"请输入订单编号"},model:{value:t.orderId,callback:function(s){t.orderId=s},expression:"orderId"}})],1),t._v(" "),e("div",{staticClass:"search_single"},[e("Select",{staticStyle:{width:"180px"},attrs:{placeholder:"订单状态"},model:{value:t.status,callback:function(s){t.status=s},expression:"status"}},t._l(t.statusArr,function(s){return e("Option",{key:s.value,attrs:{value:s.value}},[t._v(t._s(s.label))])}),1)],1),t._v(" "),e("div",{staticClass:"search_single"},[e("DatePicker",{staticStyle:{width:"180px"},attrs:{value:t.date,type:"date",placeholder:"选择出发日期"},on:{"on-change":t.dateChange}})],1)]),t._v(" "),e("div",{staticClass:"search_right"},[e("Button",{attrs:{type:"primary"},on:{click:function(s){return t.getOrderList("")}}},[t._v("搜索")]),t._v(" "),e("Button",{attrs:{type:"error"},on:{click:t.initData}},[t._v("清空")])],1)]),t._v(" "),e("div",{staticClass:"table_box"},[e("Table",{attrs:{border:"",columns:t.columns,data:t.listData},scopedSlots:t._u([{key:"status",fn:function(s){var a=s.row;return[1==a.status?e("div",{staticClass:"img_box"},[t._v("\n                   待支付\n                ")]):t._e(),t._v(" "),2==a.status?e("div",{staticClass:"img_box"},[t._v("\n                  已支付\n                ")]):t._e(),t._v(" "),3==a.status?e("div",{staticClass:"img_box"},[t._v("\n                   已取消\n                ")]):t._e(),t._v(" "),4==a.status?e("div",{staticClass:"img_box"},[t._v("\n                   支付失败\n                ")]):t._e(),t._v(" "),5==a.status?e("div",{staticClass:"img_box"},[t._v("\n                   已完成\n                ")]):t._e(),t._v(" "),6==a.status?e("div",{staticClass:"img_box"},[t._v("\n                   已评价\n                ")]):t._e(),t._v(" "),7==a.status?e("div",{staticClass:"img_box"},[t._v("\n                   已退款\n                ")]):t._e(),t._v(" "),8==a.status?e("div",{staticClass:"img_box"},[t._v("\n                   退款中\n                ")]):t._e()]}},{key:"ticket",fn:function(s){var a=s.row;return[a.num>0?e("div",{staticClass:"img_box"},[t._v("\n                   "+t._s(a.num)+"张\n                ")]):e("div",{staticClass:"img_box"},[t._v("\n                   无\n                ")])]}},{key:"action",fn:function(s){var a=s.row;return[e("Button",{attrs:{type:"primary"},on:{click:function(s){return t.bindDetail(a)}}},[t._v("查看详情")]),t._v(" "),1===a.status?e("Button",{attrs:{type:"info"},on:{click:function(s){return t.modalChange("cancleId","show",a)}}},[t._v("取消")]):t._e(),t._v(" "),2===a.status?e("Button",{attrs:{type:"info"},on:{click:function(s){return t.modalChange("completeId","show",a)}}},[t._v("完成")]):t._e(),t._v(" "),2===a.status?e("Button",{attrs:{type:"error"},on:{click:function(s){return t.modalChange("refundId","show",a)}}},[t._v("退款")]):t._e()]}}])}),t._v(" "),e("div",{staticClass:"page_box"},[e("div",{staticClass:"page_left"},[t._v("\n                共"+t._s(t.total)+"条记录 第"+t._s(t.page)+"/"+t._s(Math.ceil(t.total/t.pagesize))+"页\n            ")]),t._v(" "),e("div",{staticClass:"page_right"},[e("Page",{attrs:{total:t.total,"page-size":t.pagesize,current:t.page},on:{"on-change":t.changePage}})],1)])],1),t._v(" "),e("Modal",{staticClass:"delete_box",attrs:{"mask-closable":!1,closable:!1,width:"400"},model:{value:t.showModal,callback:function(s){t.showModal=s},expression:"showModal"}},["cancleId"===t.changeType?e("div",{staticClass:"content"},[e("p",[t._v("您确定要取消选中的订单吗？")])]):t._e(),t._v(" "),"refundId"===t.changeType?e("div",{staticClass:"content"},[e("p",[t._v("您确定要对选中的订单进行退款吗？")])]):t._e(),t._v(" "),"completeId"===t.changeType?e("div",{staticClass:"content"},[e("p",[t._v("您确定要对选中的订单进行完成操作吗？")])]):t._e(),t._v(" "),e("div",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[e("Button",{staticClass:"cancle_btn",attrs:{type:"default"},on:{click:function(s){return t.modalChange("refundId","cancle",t.row)}}},[t._v("取消")]),t._v(" "),e("Button",{attrs:{type:"primary"},on:{click:t.bindConfirm}},[t._v("确定")])],1)]),t._v(" "),e("Modal",{staticClass:"detail_modal",attrs:{"mask-closable":!1,closable:!1,title:"直通车订单",width:"780"},model:{value:t.showDetail,callback:function(s){t.showDetail=s},expression:"showDetail"}},[e("div",{staticClass:"content"},[e("div",{staticClass:"content_top"},[e("div",{staticClass:"single"},[e("p",{staticClass:"single_left"},[t._v("订单类型:")]),t._v(" "),e("p",{staticClass:"single_right"},[t._v("直通车")])]),t._v(" "),e("div",{staticClass:"single"},[e("p",{staticClass:"single_left"},[t._v("订单号:")]),t._v(" "),e("p",{staticClass:"single_right"},[t._v(t._s(t.detailInfo.order_sn))])]),t._v(" "),e("div",{staticClass:"single"},[e("p",{staticClass:"single_left"},[t._v("订单状态:")]),t._v(" "),1===t.detailInfo.status?e("p",{staticClass:"single_right"},[t._v("待支付")]):t._e(),t._v(" "),2===t.detailInfo.status?e("p",{staticClass:"single_right"},[t._v("已支付")]):t._e(),t._v(" "),3===t.detailInfo.status?e("p",{staticClass:"single_right"},[t._v("已取消")]):t._e(),t._v(" "),4===t.detailInfo.status?e("p",{staticClass:"single_right"},[t._v("支付失败")]):t._e(),t._v(" "),5===t.detailInfo.status?e("p",{staticClass:"single_right"},[t._v("已完成")]):t._e(),t._v(" "),6===t.detailInfo.status?e("p",{staticClass:"single_right"},[t._v("已评价")]):t._e(),t._v(" "),7===t.detailInfo.status?e("p",{staticClass:"single_right"},[t._v("已退款")]):t._e(),t._v(" "),8===t.detailInfo.status?e("p",{staticClass:"single_right"},[t._v("退款中")]):t._e()]),t._v(" "),e("div",{staticClass:"single"},[e("p",{staticClass:"single_left"},[t._v("支付状态:")]),t._v(" "),1===t.detailInfo.status||3===t.detailInfo.status||4===t.detailInfo.status||7===t.detailInfo.status?e("p",{staticClass:"single_right"},[t._v("支付失败")]):t._e(),t._v(" "),2===t.detailInfo.status||5===t.detailInfo.status||6===t.detailInfo.status?e("p",{staticClass:"single_right"},[t._v("支付成功")]):t._e(),t._v(" "),8===t.detailInfo.status?e("p",{staticClass:"single_right"},[t._v("退款中")]):t._e()]),t._v(" "),e("div",{staticClass:"single"},[e("p",{staticClass:"single_left"},[t._v("取消时间:")]),t._v(" "),t.detailInfo.cancel_time?e("p",{staticClass:"single_right"},[t._v(t._s(t.detailInfo.cancel_time))]):t._e()]),t._v(" "),e("div",{staticClass:"single"},[e("p",{staticClass:"single_left"},[t._v("创建时间:")]),t._v(" "),e("p",{staticClass:"single_right"},[t._v(t._s(t.detailInfo.created_at))])])]),t._v(" "),e("div",{staticClass:"content_bottom"},[e("div",{staticClass:"single"},[e("p",{staticClass:"single_left"},[t._v("预订人:")]),t._v(" "),e("p",{staticClass:"single_right"},[t._v(t._s(t.detailInfo.name))])]),t._v(" "),e("div",{staticClass:"single"},[e("p",{staticClass:"single_left"},[t._v("电话:")]),t._v(" "),e("p",{staticClass:"single_right"},[t._v(t._s(t.detailInfo.phone))])]),t._v(" "),e("div",{staticClass:"single"},[e("p",{staticClass:"single_left"},[t._v("预约日期:")]),t._v(" "),e("p",{staticClass:"single_right"},[t._v(t._s(t.detailInfo.date))])]),t._v(" "),e("div",{staticClass:"single"},[e("p",{staticClass:"single_left"},[t._v("项目名称:")]),t._v(" "),e("p",{staticClass:"single_right"},[t._v(t._s(t.detailInfo.title))])]),t._v(" "),e("div",{staticClass:"single"},[e("p",{staticClass:"single_left"},[t._v("上车地点:")]),t._v(" "),e("p",{staticClass:"single_right"},[t._v(t._s(t.detailInfo.title))])]),t._v(" "),e("div",{staticClass:"single"},[e("p",{staticClass:"single_left"},[t._v("价格:")]),t._v(" "),e("p",{staticClass:"single_right"},[t._v(t._s(t.detailInfo.priceStr))])]),t._v(" "),e("div",{staticClass:"single"},[e("p",{staticClass:"single_left"},[t._v("司机:")]),t._v(" "),t.detailInfo.driver?e("p",{staticClass:"single_right"},[t._v(t._s(t.detailInfo.driver))]):e("p",{staticClass:"single_right"},[t._v("无")])]),t._v(" "),e("div",{staticClass:"single"},[e("p",{staticClass:"single_left"},[t._v("车牌号:")]),t._v(" "),e("Select",{staticStyle:{width:"180px"},attrs:{placeholder:"请选择指派车辆",disabled:2!=t.detailInfo.status},model:{value:t.detailInfo.car_id,callback:function(s){t.$set(t.detailInfo,"car_id",s)},expression:"detailInfo.car_id"}},t._l(t.carList,function(s){return e("Option",{key:s.value,attrs:{value:s.value}},[t._v(t._s(s.label))])}),1)],1)]),t._v(" "),e("div",{staticClass:"notice_box"},[e("p",{staticClass:"notice_left"},[t._v("备注：")]),t._v(" "),t.detailInfo.remark?e("p",[t._v(t._s(t.detailInfo.remark))]):e("p",[t._v("无")])]),t._v(" "),e("div",{staticClass:"table_box"},[e("Table",{attrs:{border:"",columns:t.priceColum,data:t.priceData}})],1),t._v(" "),e("div",{staticClass:"table_box"},[e("Table",{attrs:{border:"",columns:t.userColum,data:t.userData}})],1)]),t._v(" "),e("div",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[e("Button",{staticClass:"cancle_btn",attrs:{type:"default"},on:{click:t.closeDeatil}},[t._v("取消")]),t._v(" "),2==t.detailInfo.status?e("Button",{attrs:{type:"primary"},on:{click:t.bindCar}},[t._v("确定")]):t._e()],1)]),t._v(" "),e("Button",{staticClass:"submitExcel",on:{click:t.subExcel}},[t._v("导出Excel")])],1)},staticRenderFns:[]};var o=e("VU/8")(l,n,!1,function(t){e("nEk8")},null,null);s.default=o.exports},nEk8:function(t,s){}});
//# sourceMappingURL=40.0fc97dcfeca75e3292fb.js.map