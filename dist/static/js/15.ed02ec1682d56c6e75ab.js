webpackJsonp([15],{SQ2G:function(e,t){},llTx:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("fZjL"),a=r.n(i),o=r("bOdI"),n=r.n(o),s={name:"car",data:function(){var e;return e={columns:[{title:"车辆编号",key:"id",align:"center"},{title:"车牌号",key:"plate_no",align:"center"},{title:"车辆品牌",slot:"brand_id",align:"center"},{title:"车辆型号",key:"car_model",align:"center"},{title:"车辆颜色",key:"color",align:"center"},{title:"车辆分类",slot:"belong_id",align:"center"},{title:"车辆座位数",slot:"ridership",align:"center"},{title:"操作",slot:"action",width:150,align:"center"}],data:[],page:1,pagesize:10,total:0,plate_no:"",id:"",brand_id:"",ridership:"",modalTitle:"",carPic:"",goCarPic:"",formLeft:{},editinfo:{},modal:!1,carbelong:"",carBelongList:[],color:"",carColorList:[],brand:"",carBrandList:[]},n()(e,"ridership",""),n()(e,"ridershipList",[]),n()(e,"park_id",""),n()(e,"siteList",[]),n()(e,"main_driver_id",""),n()(e,"driverList",[]),n()(e,"uploadXszImgUrl",""),n()(e,"uploadCarImgUrl",""),n()(e,"uploadImgUrl",""),n()(e,"bigKindList",[{value:1,label:"城际接送"},{value:2,label:"司乘快客"},{value:7,label:"直通车"}]),n()(e,"mainDirverList",[]),n()(e,"coDriverList",[]),n()(e,"coDriver",[]),n()(e,"driverPassengerList",[]),n()(e,"assistant_driver_id",""),e},watch:{coDriver:function(e,t){console.log("司机数据改变"),console.log(e)}},created:function(){this.$Spin.show(),this.getCarList(),this.getSelectList("/admin/index/select-car-belong","carBelongList"),this.getSelectList("/admin/index/select-car-color","carColorList"),this.getSelectList("/admin/index/select-car-ridership","ridershipList"),this.getSelectList("/admin/index/select-car-brand","carBrandList")},methods:{getSelectList:function(e,t){var r=this;this.$fetch(e).then(function(e){if(200==e.code){r.$Spin.hide();var i=a()(e.data).map(function(t,r){return{value:t,label:e.data[t]}});r[t]=i}else r.$Message.warning(e.error)}).catch(function(e){r.$Spin.hide()})},carUse:function(e){var t=this;this.formLeft.park_id?this.$fetch("/admin/dispatch/gets-driver",{type:e,park_id:this.formLeft.park_id}).then(function(e){t.mainDirverList=e.mainDriver,t.coDriverList=e.otherDriver,t.driverPassengerList=e.mainDriver,7===t.formLeft.type&&(t.driverPassengerList=e.otherDriver)}):this.formLeft.type=""},coDriverChange:function(e){this.coDriver=e},changeParkId:function(e){var t=this;this.$fetch("/admin/dispatch/gets-driver",{type:this.formLeft.type,park_id:e}).then(function(e){t.mainDirverList=e.mainDriver,t.coDriverList=e.otherDriver,t.driverPassengerList=e.mainDriver,7===t.formLeft.type&&(t.driverPassengerList=e.otherDriver)})},newSite:function(e){var t=this;this.modal=!0,e.id?(this.modalTitle="修改车辆",this.$fetch("/admin/dispatch/get-car",{id:e.id}).then(function(e){if(200==e.code){t.formLeft=e.data,t.formLeft.brand_id=t.formLeft.brand_id.toString(),t.formLeft.carbelong=t.formLeft.belong_id.toString(),t.formLeft.ridership=t.formLeft.ridership.toString(),t.uploadCarImgUrl=t.formLeft.car_img,t.uploadXszImgUrl=t.formLeft.permit_img;var r=e.data.assistant_driver_id.split(",").map(function(e,t){if(0!==e)return Number(e)});t.$fetch("/admin/dispatch/gets-driver",{type:e.data.type,park_id:t.formLeft.park_id}).then(function(e){t.mainDirverList=e.mainDriver,t.coDriverList=e.otherDriver,t.driverPassengerList=e.mainDriver,7===t.formLeft.type&&(t.driverPassengerList=e.otherDriver),setTimeout(function(){t.coDriver=r},1)})}}).catch(function(e){t.$Spin.hide()}),this.getDriverAndStation()):(this.modalTitle="新建车辆",this.formLeft={},this.uploadCarImgUrl="",this.uploadXszImgUrl="",this.getDriverAndStation())},getDriverAndStation:function(){var e=this,t=this;this.$fetch("/admin/citytransport/list-station").then(function(r){200==r.code?t.siteList=r.data.data:e.$Message.warning(r.error)}).catch(function(t){e.$Spin.hide()}),this.$fetch("/admin/dispatch/list-driver").then(function(r){if(200==r.code){var i=[];r.data.data.map(function(e){1===e.status&&i.push(e)}),t.driverList=i}else e.$Message.warning(r.error)}).catch(function(t){e.$Spin.hide()})},handleUploadiconXsz:function(e){var t=this;this.$uploadImg(e,function(e){t.uploadXszImgUrl=e})},handleUploadiconCar:function(e){var t=this;this.$uploadImg(e,function(e){t.uploadCarImgUrl=e})},handleFormatError1:function(e){this.$Message.info("图片格式不正确,请上传正确的图片格式")},getCarList:function(){var e=this,t={page:this.page,pagesize:this.pagesize,id:this.id||"",plate_no:this.plate_no||"",color:this.color||"",belong_id:this.carbelong||"",brand_id:this.brand_id||"",ridership:this.ridership||""};this.$fetch("/admin/dispatch/list-car",t).then(function(t){if(e.$Spin.hide(),200===t.code){var r=t.data.data;e.data=r,e.total=t.data.total}else e.$Message.warning(t.error)}).catch(function(t){e.$Spin.hide()})},clearSerach:function(){this.id="",this.plate_no="",this.color="",this.carbelong="",this.brand_id="",this.ridership="",this.getCarList()},changeRouteName:function(e){if(1!=this.formLeft.route_name.split("-").length-1)return this.$Message.error("输入正确的常用路线格式"),!1;var t=this.formLeft.route_name.substring(0,1),r=this.formLeft.route_name.substr(-1),i=/^[\u4e00-\u9fa5]+$/i;return i.test(t)&&i.test(r)?void 0:(this.$Message.error("输入正确的常用路线格式"),!1)},infoSure:function(e){var t=this;if("新建车辆"==e){var r=this.formLeft,i=[];this.coDriver.map(function(e,t){0!==e&&i.push(e)});var a=i.toString();if(r.plate_no&&r.brand_id&&r.car_model&&r.carbelong&&r.ridership&&r.color&&r.main_driver_id&&r.park_id&&1<=i.length<=3){var o=parseInt(r.ridership),n=parseInt(r.carbelong),s=parseInt(r.brand_id),l=this.uploadCarImgUrl,d=this.uploadXszImgUrl;this.$post("/admin/dispatch/add-car",{plate_no:r.plate_no,brand_id:s,car_model:r.car_model,belong_id:n,ridership:o,color:r.color,main_driver_id:r.main_driver_id,park_id:r.park_id,remark:r.remark,car_img:l,permit_img:d,assistant_driver_id:a,type:r.type,route_name:r.route_name}).then(function(e){200==e.code?(t.$Message.info("新建车辆成功"),t.modal=!1,t.getCarList()):t.$Message.warning(e.error)}).catch(function(e){t.$Spin.hide()})}else{if(!r.plate_no)return void this.$Message.error("请填写车牌号");if(!r.brand_id)return void this.$Message.error("请选择车辆品牌");if(!r.car_model)return void this.$Message.error("请填写车辆类型");if(!r.carbelong)return void this.$Message.error("请选择车辆分类");if(!r.ridership)return void this.$Message.error("请选择车辆座位数");if(!r.color)return void this.$Message.error("请选择车辆颜色");if(r.main_driver_id){if(!r.park_id)return void this.$Message.error("请选择停放站点");if(i.length>3||i.length<1)return void this.$Message.error("副司机数量至少一个，至多3个")}else if(7!=this.formLeft.type)return void this.$Message.error("请选择匹配司机")}}else if("修改车辆"==e){var c=this.formLeft,f=this.uploadCarImgUrl,p=this.uploadXszImgUrl,u=[];this.coDriver.map(function(e,t){0!==e&&u.push(e)});var m=u.toString();if(c.plate_no&&c.brand_id&&c.car_model&&c.carbelong&&c.ridership&&c.color&&c.main_driver_id&&c.park_id&&1<=u.length<=3){var h=parseInt(c.ridership),v=parseInt(c.carbelong),_=parseInt(c.brand_id);this.$post("/admin/dispatch/edit-car",{id:c.id,plate_no:c.plate_no,brand_id:_,car_model:c.car_model,belong_id:v,ridership:h,color:c.color,main_driver_id:c.main_driver_id,park_id:c.park_id,remark:c.remark,car_img:f,permit_img:p,assistant_driver_id:m,type:c.type,route_name:c.route_name}).then(function(e){200==e.code?(t.$Message.info("修改车辆成功"),t.modal=!1,t.getCarList()):t.$Message.warning(e.error)}).catch(function(e){t.$Spin.hide()})}else{if(!c.plate_no)return void this.$Message.error("请填写车牌号");if(!c.brand_id)return void this.$Message.error("请选择车辆品牌");if(!c.car_model)return void this.$Message.error("请填写车辆类型");if(!c.carbelong)return void this.$Message.error("请选择车辆分类");if(!c.ridership)return void this.$Message.error("请选择车辆座位数");if(!c.color)return void this.$Message.error("请选择车辆颜色");if(!c.main_driver_id)return void this.$Message.error("请选择匹配司机");if(!c.park_id)return void this.$Message.error("请选择停放站点");if(u.length>3||u.length<1)return void this.$Message.error("最多只能选择三个副司机")}}},remove:function(e,t){var r=this;this.$Modal.confirm({title:"你确定要删除该车辆吗？",okText:"确定",cancelText:"取消",onOk:function(){var i=this;this.$post("/admin/dispatch/del-car",{id:e}).then(function(e){200==e.code?(i.$Message.info("删除车辆成功"),r.data.splice(t,1)):i.$Message.warning(e.error)}).catch(function(e){i.$Spin.hide()})},onCancel:function(){}})},cancel:function(e){this.formLeft={},this.modal=!1,this.uploadCarImgUrl="",this.uploadXszImgUrl=""},changePage:function(e){this.page=e,this.getCarList("page")}}},l={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{staticClass:"new_site"},[r("div",{staticClass:"inputMsg"},[r("Input",{staticStyle:{width:"120px"},attrs:{type:"number",placeholder:"搜索车辆编号"},model:{value:e.id,callback:function(t){e.id=t},expression:"id"}}),e._v(" "),r("Input",{staticStyle:{width:"120px"},attrs:{type:"text",placeholder:"搜索车牌号"},model:{value:e.plate_no,callback:function(t){e.plate_no=t},expression:"plate_no"}}),e._v(" "),r("Select",{staticStyle:{width:"120px"},attrs:{placeholder:"搜索颜色"},model:{value:e.color,callback:function(t){e.color=t},expression:"color"}},e._l(e.carColorList,function(t){return r("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])}),1),e._v(" "),r("Select",{staticStyle:{width:"120px"},attrs:{placeholder:"搜索车辆分类"},model:{value:e.carbelong,callback:function(t){e.carbelong=t},expression:"carbelong"}},e._l(e.carBelongList,function(t){return r("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])}),1),e._v(" "),r("Select",{staticStyle:{width:"120px"},attrs:{placeholder:"搜索品牌"},model:{value:e.brand_id,callback:function(t){e.brand_id=t},expression:"brand_id"}},e._l(e.carBrandList,function(t){return r("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])}),1),e._v(" "),r("Select",{staticStyle:{width:"120px"},attrs:{placeholder:"搜索座位数"},model:{value:e.ridership,callback:function(t){e.ridership=t},expression:"ridership"}},e._l(e.ridershipList,function(t){return r("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])}),1)],1),e._v(" "),r("div",{staticClass:"btns"},[r("Button",{attrs:{type:"primary"},on:{click:e.getCarList}},[e._v("搜索")]),e._v(" "),r("Button",{attrs:{type:"error"},on:{click:e.clearSerach}},[e._v("清空")]),e._v(" "),r("Button",{staticClass:"newBtn",attrs:{type:"primary"},on:{click:e.newSite}},[r("Icon",{attrs:{type:"md-add"}}),e._v("新建\n      ")],1)],1)]),e._v(" "),r("Table",{attrs:{border:"",columns:e.columns,data:e.data},scopedSlots:e._u([{key:"brand_id",fn:function(t){var i=t.row;return t.index,e._l(e.carBrandList,function(t){return r("div",{key:t.value,attrs:{value:t.value}},[i.brand_id==t.value?r("div",[e._v(e._s(t.label))]):e._e()])})}},{key:"belong_id",fn:function(t){var i=t.row;return t.index,e._l(e.carBelongList,function(t){return r("div",{key:t.value,attrs:{value:t.value}},[i.belong_id==t.value?r("div",[e._v(e._s(t.label))]):e._e()])})}},{key:"ridership",fn:function(t){var r=t.row;return t.index,[e._v(e._s(r.ridership)+"座")]}},{key:"action",fn:function(t){var i=t.row,a=t.index;return[r("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(t){return e.newSite(i)}}},[e._v("修改")]),e._v(" "),r("Button",{attrs:{type:"error",size:"small"},on:{click:function(t){return e.remove(i.id,a)}}},[e._v("删除")])]}}])}),e._v(" "),r("div",{staticClass:"driver_model"},[r("Modal",{attrs:{title:e.modalTitle,transfer:!1,"mask-closable":!1,closable:!1},model:{value:e.modal,callback:function(t){e.modal=t},expression:"modal"}},[r("Form",{ref:"formLeft",attrs:{model:e.formLeft,"label-position":"left","label-width":100}},[r("FormItem",{attrs:{label:"行驶证照片:",prop:"goCarPic"}},[r("Upload",{ref:"upload",staticStyle:{display:"inline-block"},attrs:{"show-upload-list":!1,format:["jpg","jpeg","png"],"max-size":2048,"on-format-error":e.handleFormatError1,"before-upload":e.handleUploadiconXsz,multiple:"",type:"drag",name:"file",action:""}},[r("div",{staticStyle:{width:"130px",height:"100px"}},[r("img",{staticClass:"upload_img_css",attrs:{src:e.uploadXszImgUrl,alt:""}})])])],1),e._v(" "),r("FormItem",{attrs:{label:"车辆照片:",prop:"carPic"}},[r("Upload",{ref:"upload",staticStyle:{display:"inline-block"},attrs:{"show-upload-list":!1,format:["jpg","jpeg","png"],"max-size":2048,"on-format-error":e.handleFormatError1,"before-upload":e.handleUploadiconCar,multiple:"",type:"drag",name:"file",action:""}},[r("div",{staticStyle:{width:"130px",height:"100px"}},[r("img",{staticClass:"upload_img_css",attrs:{src:e.uploadCarImgUrl,alt:""}})])])],1),e._v(" "),r("FormItem",{attrs:{label:"车牌号",prop:"plate_no",required:""}},[r("Input",{attrs:{maxlength:"10"},model:{value:e.formLeft.plate_no,callback:function(t){e.$set(e.formLeft,"plate_no",t)},expression:"formLeft.plate_no"}})],1),e._v(" "),r("FormItem",{attrs:{label:"停放站点",prop:"park_id",required:""}},[r("Select",{staticStyle:{width:"200px",float:"left"},on:{"on-change":e.changeParkId},model:{value:e.formLeft.park_id,callback:function(t){e.$set(e.formLeft,"park_id",t)},expression:"formLeft.park_id"}},e._l(e.siteList,function(t){return r("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])}),1)],1),e._v(" "),r("FormItem",{attrs:{label:"车辆品牌",prop:"brand_id",required:""}},[r("Select",{staticStyle:{width:"120px",float:"left"},attrs:{placeholder:"车辆品牌"},model:{value:e.formLeft.brand_id,callback:function(t){e.$set(e.formLeft,"brand_id",t)},expression:"formLeft.brand_id"}},e._l(e.carBrandList,function(t){return r("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])}),1)],1),e._v(" "),r("FormItem",{attrs:{label:"车辆用途",prop:"type",required:""}},[r("Select",{staticStyle:{width:"140px",float:"left"},attrs:{placeholder:"车辆用途"},on:{"on-change":e.carUse},model:{value:e.formLeft.type,callback:function(t){e.$set(e.formLeft,"type",t)},expression:"formLeft.type"}},e._l(e.bigKindList,function(t){return r("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])}),1),e._v(" "),1==e.formLeft.type?r("div",[r("Select",{staticStyle:{width:"140px",float:"left","margin-left":"2px"},attrs:{placeholder:"主司机"},model:{value:e.formLeft.main_driver_id,callback:function(t){e.$set(e.formLeft,"main_driver_id",t)},expression:"formLeft.main_driver_id"}},e._l(e.mainDirverList,function(t){return r("Option",{key:t.id,attrs:{value:t.id,disabled:1==t.is_bind}},[e._v(e._s(t.name))])}),1),e._v(" "),r("div",{staticClass:"checkbox"},[r("span",{staticStyle:{"font-size":"16px"}},[e._v("副司机：")]),e._v(" "),r("CheckboxGroup",{on:{"on-change":e.coDriverChange},model:{value:e.coDriver,callback:function(t){e.coDriver=t},expression:"coDriver"}},[e._l(e.coDriverList,function(t,i){return[r("Checkbox",{key:i,attrs:{label:t.id}},[e._v(e._s(t.name))])]})],2)],1)],1):e._e(),e._v(" "),2==e.formLeft.type||7==e.formLeft.type?r("div",[r("Select",{staticStyle:{width:"140px",float:"left","margin-left":"2px"},attrs:{placeholder:"匹配司机"},model:{value:e.formLeft.main_driver_id,callback:function(t){e.$set(e.formLeft,"main_driver_id",t)},expression:"formLeft.main_driver_id"}},e._l(e.driverPassengerList,function(t){return r("Option",{key:t.id,attrs:{value:t.id,disabled:1==t.is_bind}},[e._v(e._s(t.name))])}),1),e._v(" "),r("div",{staticStyle:{float:"left","text-align":"left"}},[e._v("\n              常用路线：(例如：成都-康定)\n              "),r("Input",{attrs:{maxlength:"10",placeholder:"例如：成都-康定"},on:{"on-change":e.changeRouteName},model:{value:e.formLeft.route_name,callback:function(t){e.$set(e.formLeft,"route_name",t)},expression:"formLeft.route_name"}})],1)],1):e._e()],1),e._v(" "),r("FormItem",{attrs:{label:"车辆型号",prop:"car_model",required:""}},[r("Input",{attrs:{maxlength:"10"},model:{value:e.formLeft.car_model,callback:function(t){e.$set(e.formLeft,"car_model",t)},expression:"formLeft.car_model"}})],1),e._v(" "),r("FormItem",{attrs:{label:"车辆分类",prop:"carbelong",required:""}},[r("Select",{staticStyle:{width:"120px",float:"left"},attrs:{placeholder:"车辆分类"},model:{value:e.formLeft.carbelong,callback:function(t){e.$set(e.formLeft,"carbelong",t)},expression:"formLeft.carbelong"}},e._l(e.carBelongList,function(t){return r("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])}),1)],1),e._v(" "),r("FormItem",{attrs:{label:"车辆座位数",prop:"ridership",required:""}},[r("Select",{staticStyle:{width:"120px",float:"left"},attrs:{placeholder:"车辆座位数"},model:{value:e.formLeft.ridership,callback:function(t){e.$set(e.formLeft,"ridership",t)},expression:"formLeft.ridership"}},e._l(e.ridershipList,function(t){return r("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])}),1)],1),e._v(" "),r("FormItem",{attrs:{label:"颜色",prop:"color",required:""}},[r("Select",{staticStyle:{width:"120px",float:"left"},attrs:{placeholder:"颜色"},model:{value:e.formLeft.color,callback:function(t){e.$set(e.formLeft,"color",t)},expression:"formLeft.color"}},e._l(e.carColorList,function(t){return r("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])}),1)],1),e._v(" "),r("FormItem",{attrs:{label:"备注",prop:"remark"}},[r("Input",{attrs:{maxlength:"100",type:"textarea"},model:{value:e.formLeft.remark,callback:function(t){e.$set(e.formLeft,"remark",t)},expression:"formLeft.remark"}})],1)],1),e._v(" "),r("div",{attrs:{slot:"footer"},slot:"footer"},[r("Button",{attrs:{type:"text",size:"large"},on:{click:function(t){return e.cancel(e.modalTitle)}}},[e._v("取消")]),e._v(" "),r("Button",{attrs:{type:"primary",size:"large"},on:{click:function(t){return e.infoSure(e.modalTitle)}}},[e._v("确定")])],1)],1)],1),e._v(" "),r("div",{staticClass:"page_box"},[r("div",{staticClass:"page_left"},[e._v("\n      共"+e._s(e.total)+"条记录 第"+e._s(e.page)+"/"+e._s(Math.ceil(e.total/e.pagesize))+"页\n    ")]),e._v(" "),r("div",{staticClass:"page_right"},[r("Page",{attrs:{total:e.total,"page-size":e.pagesize,current:e.page},on:{"on-change":e.changePage}})],1)])],1)},staticRenderFns:[]};var d=r("VU/8")(s,l,!1,function(e){r("SQ2G")},"data-v-efb6bc46",null);t.default=d.exports}});
//# sourceMappingURL=15.ed02ec1682d56c6e75ab.js.map