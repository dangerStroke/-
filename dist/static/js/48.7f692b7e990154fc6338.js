webpackJsonp([48],{H0w6:function(e,t){},HS9B:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("Dd8w"),o=a.n(r),i=a("mtWM"),n=a.n(i),s=a("QaH6"),l=(a("E0VQ"),{data:function(){return{stime:"",etime:"",plate_no:"",columns:[{type:"index",title:"序号",align:"center"},{title:"车牌号",key:"plate_no",align:"center"},{title:"车辆品牌",slot:"brand",align:"center"},{title:"车辆型号",key:"car_model",align:"center"},{title:"车辆状态",key:"free_type",align:"center",width:125},{title:"空闲情况",key:"free_time",align:"center",width:200},{title:"车型描述",key:"car_text",align:"center"},{title:"操作",slot:"action",align:"center",width:300}],listData:[],page:1,pagesize:10,total:0,showDetail:!1,carDetail:"",driverName:"",driverList:[],orderStatus:"",statusList:[{value:1,label:"未支付"},{value:2,label:"待出行"},{value:3,label:"已取消"},{value:4,label:"支付失败"},{value:5,label:"已完成"},{value:6,label:"已评价"},{value:7,label:"已退款"},{value:8,label:"退款中"},{value:9,label:"进行中"},{value:10,label:"待审核"},{value:12,label:"全款支付"}],formLeft:{},brandList:"",config:{firstDay:"0",locale:"zh-cn",defaultView:"month",height:"auto",fixedweekCount:!1,allDaySlot:!1,header:{left:" prev, next, today",center:"title",right:"custom"}},events:[]}},components:{FullCalendar:s.a},methods:{getListOrder:function(){var e=this,t=this.plate_no,a=new Date((new Date).setTime(new Date((new Date).getFullYear(),(new Date).getMonth(),1))),r=a.getFullYear()+"-"+(a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1)+"-"+a.getDate(),i=new Date((new Date).setTime(new Date((new Date).getMonth+1<=12?(new Date).getFullYear():(new Date).getFullYear()+1,(new Date).getMonth()+1<=12?(new Date).getMonth()+1:1,1))-864e5),n={stime:r,etime:i.getFullYear()+"-"+(i.getMonth()+1<10?"0"+(i.getMonth()+1):i.getMonth()+1)+"-"+i.getDate(),plate_no:t,page_size:999999};this.$fetch("/admin/car-manage/list-order",o()({},n)).then(function(t){if(200==t.code){var a=[];t.data.data.map(function(e,t){console.log(e);var r=new Date(new Date(e.etime.slice(0,10).replace(/-/g,"/")).getTime()+864e5);e.etime=r.getFullYear()+"-"+(r.getMonth()+1<10?"0"+(r.getMonth()+1):r.getMonth()+1)+"-"+r.getDate();a.push({id:e.id,title:e.plate_no,start:e.stime.slice(0,10),end:e.etime,backgroundColor:"",borderColor:"",car_id:e.car_id})}),a[0].backgroundColor="red",a[0].borderColor="red";for(var r=0;r<a.length;r++)for(var o=r+1;o<a.length;o++)if(a[r].car_id==a[o].car_id)a[o].backgroundColor=a[r].backgroundColor,a[o].borderColor=a[r].borderColor;else if(""==a[o].backgroundColor){var i=Math.floor(255*Math.random()),n=Math.floor(255*Math.random()),s=Math.floor(255*Math.random());a[o].backgroundColor="rgb("+i+","+n+","+s+")",a[o].borderColor="rgb("+i+","+n+","+s+")"}e.events=a}})},eventClick:function(e){console.log(e)},dayClick:function(e){console.log(e)},changePage:function(e){this.page=e,this.getcarList()},eliminate:function(){console.log(123),this.plate_no="",this.getTime(),this.getcarList()},modifyOrder:function(e){this.carDetail=e,this.formLeft.car_id=e.id,this.showDetail=!0},detailOrder:function(e){console.log(e),this.$router.push({name:"carDispatch",query:{id:e.id,stime:this.stime,etime:this.etime,plate_no:e.plate_no}})},timeChange:function(e,t){switch(e){case"stime":this.stime=t;break;case"etime":this.etime=t;break;case"formLeft.deposit_time":this.formLeft.deposit_time=t;break;case"formLeft.remaining_time":this.formLeft.remaining_time=t;break;case"formLeft.stime":this.formLeft.stime=t;break;case"formLeft.etime":this.formLeft.etime=t;break;case"formLeft.order_status":this.formLeft.order_status=t}},getcarList:function(){var e=this,t={stime:this.stime,etime:this.etime,plate_no:this.plate_no,page:this.page,pagesize:this.pagesize};this.$fetch("/admin/car-manage/list-car",t).then(function(t){200==t.code&&t.data?(e.total=t.data.total,t.data.data.map(function(e){e.car_text=e.color+"色",e.free_time=e.free_time.join("")}),e.listData=t.data.data,e.getListOrder()):e.$Message.warning(t.error)})},getcarBrand:function(){var e=this;this.$fetch("/admin/index/select-car-brand").then(function(t){200==t.code&&t.data&&(e.brandList=t.data)})},distributionOrder:function(){var e=this,t=this.formLeft,a=t.order_status,r=t.stime,o=t.etime,i=t.slocation,n=t.elocation,s=t.passenger_nums;t.id_card_num,t.phone;if(this.formLeft.edistance=this.formLeft.edistance?this.formLeft.edistance:0,this.formLeft.sdistance=this.formLeft.sdistance?this.formLeft.sdistance:0,a&&r&&o&&i&&n&&s){var l=this.formLeft;this.$post("/admin/car-manage/add-order",l).then(function(t){200==t.code&&t.data?(e.$Message.warning("分配订单成功"),e.getcarList(),e.cancel()):e.$Message.warning(t.error)})}else a?r?o?i?n?s||this.$Message.warning("请填写乘客数量"):this.$Message.warning("请选择目的地"):this.$Message.warning("请选择出发地"):this.$Message.warning("请选择到达时间"):this.$Message.warning("请选择出发时间"):this.$Message.warning("请选择订单状态")},cancel:function(){this.formLeft={},this.showDetail=!1},getTime:function(){var e=new Date(new Date((new Date).toLocaleDateString()).getTime()).toLocaleDateString().replace(/\//g,"-"),t=new Date(new Date((new Date).toLocaleDateString()).getTime()+864e6).toLocaleDateString().replace(/\//g,"-"),a="",r="";e.split("-").map(function(e){e=Number(e)<10?"0"+e:e,a+="-"+e}),t.split("-").map(function(e){e=Number(e)<10?"0"+e:e,r+="-"+e}),this.stime=a.slice(1),this.etime=r.slice(1)},getDriver:function(){var e=this;this.$fetch("/admin/index/select-driver").then(function(t){if(200==t.code&&t.data)for(var a in t.data)e.driverList.push({value:a,label:t.data[a]});else e.$Message.warning(t.error)})},subExcel:function(){var e={stime:this.stime,etime:this.etime,plate_no:this.plate_no,page:this.page,pagesize:999999},t=window.location.host,a="";a="localhost:8080"==t||"dev-admin.jd-gz.com"==t?"http://dev.jd-gz.com/admin/car-manage/list-car-excel":"admin.jd-gz.com"==t?"http://api.jd-gz.com/admin/car-manage/list-car-excel":"http://adminlocal/admin/car-manage/list-car-excel",n.a.get(a,{params:e,responseType:"blob"}).then(function(e){var t=e.data,a=new FileReader;a.readAsDataURL(t),a.onload=function(e){var t=document.createElement("a");t.download="直通车订单报表.xls",t.href=e.target.result,document.body.appendChild(t),t.click(),document.body.removeChild(t)}}).catch(function(e){console.log(e.message)})}},created:function(){this.getTime(),this.getcarBrand(),this.getDriver()},mounted:function(){this.getcarList()}}),c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"head"},[a("div",{staticClass:"inputBox"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.plate_no,expression:"plate_no"}],staticClass:"input_text",attrs:{type:"text",placeholder:"搜索车牌号"},domProps:{value:e.plate_no},on:{input:function(t){t.target.composing||(e.plate_no=t.target.value)}}})]),e._v(" "),a("div",{staticClass:"inputBox"},[a("Col",{attrs:{span:"12"}},[a("DatePicker",{staticStyle:{width:"200px"},attrs:{type:"date",placeholder:"开始时间",value:e.stime},on:{"on-change":function(t){return e.timeChange("stime",t)}}})],1)],1),e._v(" "),a("div",{staticClass:"inputBox"},[a("Col",{attrs:{span:"12"}},[a("DatePicker",{staticStyle:{width:"200px"},attrs:{type:"date",placeholder:"结束时间",value:e.etime},on:{"on-change":function(t){return e.timeChange("etime",t)}}})],1)],1),e._v(" "),a("div",{staticClass:"inputBox"},[a("Button",{attrs:{type:"primary"},on:{click:e.getcarList}},[e._v("搜索")])],1),e._v(" "),a("div",{staticClass:"inputBox"},[a("Button",{attrs:{type:"error"},on:{click:e.eliminate}},[e._v("清除")])],1)]),e._v(" "),a("div",{staticClass:"tableBox"},[a("Table",{attrs:{border:"",columns:e.columns,data:e.listData},scopedSlots:e._u([{key:"action",fn:function(t){var r=t.row;return["占用"!==r.free_type?a("Button",{attrs:{type:"primary"},on:{click:function(t){return e.modifyOrder(r)}}},[e._v("分配订单")]):e._e(),e._v(" "),a("Button",{attrs:{type:"error"},on:{click:function(t){return e.detailOrder(r)}}},[e._v("订单详情")])]}},{key:"brand",fn:function(t){var r=t.row;return[a("div",[e._v(e._s(e.brandList[r.brand_id]))])]}}])})],1),e._v(" "),a("div",{staticClass:"driver_model"},[a("Modal",{attrs:{transfer:!1,"mask-closable":!1,closable:!1,title:"分配订单"},model:{value:e.showDetail,callback:function(t){e.showDetail=t},expression:"showDetail"}},[a("Form",{ref:"formLeft",attrs:{model:e.formLeft,"label-position":"left","label-width":100}},[a("FormItem",{attrs:{label:"车辆品牌:",prop:"plate_model"}},[a("div",[e._v(e._s(e.brandList[e.carDetail.brand_id]))])]),e._v(" "),a("FormItem",{attrs:{label:"车牌号:",prop:"plate_no"}},[a("div",[e._v(e._s(e.carDetail.plate_no))])]),e._v(" "),a("FormItem",{attrs:{label:"关联订单号:",prop:"order_sn"}},[a("Input",{attrs:{maxlength:"50",placeholder:"请输入关联订单号"},model:{value:e.formLeft.order_sn,callback:function(t){e.$set(e.formLeft,"order_sn",t)},expression:"formLeft.order_sn"}})],1),e._v(" "),a("FormItem",{attrs:{label:"订单状态:",prop:"order_status",required:"","show-message":!1}},[a("Select",{staticStyle:{width:"200px"},on:{"on-change":function(t){return e.timeChange("formLeft.order_status",t)}},model:{value:e.formLeft.order_status,callback:function(t){e.$set(e.formLeft,"order_status",t)},expression:"formLeft.order_status"}},e._l(e.statusList,function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])}),1)],1),e._v(" "),a("FormItem",{attrs:{label:"订单类型:",prop:"order_type"}},[a("Input",{attrs:{maxlength:"20",placeholder:"请输入订单类型"},model:{value:e.formLeft.order_type,callback:function(t){e.$set(e.formLeft,"order_type",t)},expression:"formLeft.order_type"}})],1),e._v(" "),a("FormItem",{attrs:{label:"定金:",prop:"deposit"}},[a("Input",{attrs:{maxlength:"20",placeholder:"请输入定金"},model:{value:e.formLeft.deposit,callback:function(t){e.$set(e.formLeft,"deposit",t)},expression:"formLeft.deposit"}})],1),e._v(" "),a("FormItem",{attrs:{label:"定金支付时间:",prop:"deposit_time"}},[a("Col",{attrs:{span:"12"}},[a("DatePicker",{staticStyle:{width:"200px"},attrs:{type:"date",placeholder:"请选择支付时间",value:e.formLeft.deposit_time},on:{"on-change":function(t){return e.timeChange("formLeft.deposit_time",t)}}})],1)],1),e._v(" "),a("FormItem",{attrs:{label:"尾款:",prop:"remaining"}},[a("Input",{attrs:{maxlength:"20",placeholder:"请输入尾款"},model:{value:e.formLeft.remaining,callback:function(t){e.$set(e.formLeft,"remaining",t)},expression:"formLeft.remaining"}})],1),e._v(" "),a("FormItem",{attrs:{label:"尾款支付时间:",prop:"remaining_time"}},[a("Col",{attrs:{span:"12"}},[a("DatePicker",{staticStyle:{width:"200px"},attrs:{type:"date",placeholder:"请选择支付时间",value:e.formLeft.remaining_time},on:{"on-change":function(t){return e.timeChange("formLeft.remaining_time",t)}}})],1)],1),e._v(" "),a("FormItem",{attrs:{label:"出发日:",prop:"stime",required:"","show-message":!1}},[a("Col",{attrs:{span:"12"}},[a("DatePicker",{staticStyle:{width:"200px"},attrs:{type:"date",placeholder:"选择出发日期",value:e.formLeft.stime},on:{"on-change":function(t){return e.timeChange("formLeft.stime",t)}}})],1)],1),e._v(" "),a("FormItem",{attrs:{label:"到达日:",prop:"etime",required:"","show-message":!1}},[a("Col",{attrs:{span:"12"}},[a("DatePicker",{staticStyle:{width:"200px"},attrs:{type:"date",placeholder:"选择到达日期",value:e.formLeft.etime},on:{"on-change":function(t){return e.timeChange("formLeft.etime",t)}}})],1)],1),e._v(" "),a("FormItem",{attrs:{label:"出发地:",prop:"plate_no",required:"","show-message":!1}},[a("Input",{attrs:{maxlength:"20",placeholder:"请输入出发地"},model:{value:e.formLeft.slocation,callback:function(t){e.$set(e.formLeft,"slocation",t)},expression:"formLeft.slocation"}})],1),e._v(" "),a("FormItem",{attrs:{label:"目的地:",prop:"plate_no",required:"","show-message":!1}},[a("Input",{attrs:{maxlength:"20",placeholder:"请输入目的地"},model:{value:e.formLeft.elocation,callback:function(t){e.$set(e.formLeft,"elocation",t)},expression:"formLeft.elocation"}})],1),e._v(" "),a("FormItem",{attrs:{label:"出发公里数:",prop:"sdistance"}},[a("Input",{attrs:{maxlength:"20",placeholder:"请输入公里数"},model:{value:e.formLeft.sdistance,callback:function(t){e.$set(e.formLeft,"sdistance",t)},expression:"formLeft.sdistance"}})],1),e._v(" "),a("FormItem",{attrs:{label:"到达公里数:",prop:"edistance"}},[a("Input",{attrs:{maxlength:"20",placeholder:"请输入公里数"},model:{value:e.formLeft.edistance,callback:function(t){e.$set(e.formLeft,"edistance",t)},expression:"formLeft.edistance"}})],1),e._v(" "),a("FormItem",{attrs:{label:"司机:",prop:"plate_no"}},[a("Select",{staticStyle:{width:"200px"},model:{value:e.formLeft.driver_id,callback:function(t){e.$set(e.formLeft,"driver_id",t)},expression:"formLeft.driver_id"}},e._l(e.driverList,function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])}),1)],1),e._v(" "),a("FormItem",{attrs:{label:"乘客数:",prop:"passenger_nums",required:"","show-message":!1}},[a("Input",{attrs:{maxlength:"20",placeholder:"请输入乘客数"},model:{value:e.formLeft.passenger_nums,callback:function(t){e.$set(e.formLeft,"passenger_nums",t)},expression:"formLeft.passenger_nums"}})],1),e._v(" "),a("FormItem",{attrs:{label:"乘客电话:",prop:"phone","show-message":!1}},[a("Input",{attrs:{maxlength:"20",placeholder:"请输入乘客电话"},model:{value:e.formLeft.phone,callback:function(t){e.$set(e.formLeft,"phone",t)},expression:"formLeft.phone"}})],1),e._v(" "),a("FormItem",{attrs:{label:"乘客身份证:",prop:"id_card_num","show-message":!1}},[a("Input",{attrs:{maxlength:"20",placeholder:"请输入乘客身份证"},model:{value:e.formLeft.id_card_num,callback:function(t){e.$set(e.formLeft,"id_card_num",t)},expression:"formLeft.id_card_num"}})],1)],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"text",size:"large"},on:{click:e.cancel}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{type:"primary",size:"large"},on:{click:e.distributionOrder}},[e._v("确定")])],1)],1)],1),e._v(" "),a("Button",{staticClass:"submitExcel",on:{click:e.subExcel}},[e._v("导出Excel")]),e._v(" "),a("div",{staticClass:"page_box"},[a("div",{staticClass:"page_left"},[e._v("\n          共"+e._s(e.total)+"条记录 第"+e._s(e.page)+"/"+e._s(Math.ceil(e.total/e.pagesize))+"页\n      ")]),e._v(" "),a("div",{staticClass:"page_right"},[a("Page",{attrs:{total:e.total,"page-size":e.pagesize,current:e.page},on:{"on-change":e.changePage}})],1)]),e._v(" "),a("full-calendar",{ref:"calendar",attrs:{config:e.config,events:e.events}})],1)},staticRenderFns:[]};var m=a("VU/8")(l,c,!1,function(e){a("H0w6")},"data-v-0041cfaa",null);t.default=m.exports}});
//# sourceMappingURL=48.7f692b7e990154fc6338.js.map