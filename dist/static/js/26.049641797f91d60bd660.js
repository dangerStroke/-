webpackJsonp([26],{fMrZ:function(t,e){},neZn:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("mvHQ"),s=i.n(a),n=i("fZjL"),r=i.n(n),o={name:"coupon",data:function(){return{columns12:[{title:"状态",slot:"status",align:"center"},{title:"优惠卷编号",key:"id",align:"center"},{title:"面值金额(分)",key:"money",align:"center"},{title:"数量(张)",slot:"is_limit",align:"center"},{title:"限用线路",slot:"route_id",align:"center"},{title:"发放有效期(天)",key:"validity_day",align:"center"},{title:"备注",key:"remark",align:"center"},{title:"上架时间",key:"updated_at",align:"center"},{title:"操作",slot:"action",width:200,align:"center"}],data6:[],queryParams:{status:"",route_id:""},statusList:[{value:1,label:"未上架"},{value:2,label:"上架"},{value:3,label:"已下架"}],routeList:[],modal:!1,modalTitle:"",formLeft:{},limitedRouteList:[],page:1,pagesize:10,total:0,makeSureEditId:""}},created:function(){this.$Spin.show(),this.getRouteList(),this.getTableData()},methods:{getTableData:function(t){var e=this;"page"!==t&&(this.page=1);var i={page:this.page,page_size:this.pagesize,status:this.queryParams.status||-1,route_id:this.queryParams.route_id||0};this.$fetch("/admin/coupon/list",i).then(function(t){if(e.$Spin.hide(),200==t.code){var i=[],a=t.data.ret.map(function(t){return 4!==t.status&&i.push(t),i});e.data6=a[0],e.total=t.data.total}else e.$Message.warning(t.error)}).catch(function(t){e.$Spin.hide()})},getRouteList:function(){var t=this;this.$fetch("/admin/index/select-route").then(function(e){if(200==e.code){var i=r()(e.data).map(function(t,i){return{value:t,label:e.data[t]}});console.log(i);var a=JSON.parse(s()(i));a.unshift({value:"0",label:"全部路线"}),console.log(a),t.routeList=a}else t.$Message.warning(e.error)}).catch(function(e){t.$Spin.hide()})},newSite:function(t){this.modal=!0,t.id?(this.modalTitle="修改优惠卷",this.formLeft=t,this.formLeft.route_id=t.route_id.toString(),this.formLeft.is_limit=t.is_limit.toString(),this.makeSureEditId=t.id):(this.modalTitle="新建优惠卷",this.formLeft={})},infoSure:function(t){var e=this;if(console.log(t),"新建优惠卷"==t){var i=this.formLeft;if(i.money&&i.validity_day&&i.is_limit&&i.route_id){if("0"===i.is_limit&&i.numbers)this.$post("/admin/coupon/add",i).then(function(t){console.log(t),200==t.code?(e.$Message.info("新增优惠卷成功"),e.getTableData(),e.modal=!1):e.$Message.warning(t.error)}).catch(function(t){e.$Spin.hide()});else if("0"===i.is_limit&&!i.numbers)return void this.$Message.warning("请填写限量数量");"1"===i.is_limit&&(i.numbers=0,this.$post("/admin/coupon/add",i).then(function(t){200==t.code&&(e.$Message.info("新增优惠卷成功"),e.getTableData(),e.modal=!1)}).catch(function(t){e.$Spin.hide()}))}else{if(!i.money)return void this.$Message.warning("请输入面值金额");if(!i.validity_day)return void this.$Message.warning("请输入有效天数");if(!i.is_limit)return void this.$Message.warning("请选择发放数量");if(!i.route_id)return void this.$Message.warning("请选择限用路线")}}else if("修改优惠卷"==t){var a=this.formLeft;if(a.money&&a.validity_day&&a.is_limit&&a.route_id){if("0"===a.is_limit&&a.numbers)this.$post("/admin/coupon/save",a).then(function(t){console.log(t),200==t.code?(e.$Message.info("修改优惠卷成功"),e.getTableData(),e.modal=!1):e.$Message.warning(t.error)}).catch(function(t){e.$Spin.hide()});else if("0"===a.is_limit&&!a.numbers)return void this.$Message.warning("请填写限量数量");"1"===a.is_limit&&(a.numbers=0,this.$post("/admin/coupon/save",a).then(function(t){200==t.code&&(e.$Message.info("修改优惠卷成功"),e.getTableData(),e.modal=!1)}).catch(function(t){e.$Spin.hide()}))}else{if(!a.money)return void this.$Message.warning("请输入面值金额");if(!a.validity_day)return void this.$Message.warning("请输入有效天数");if(!a.is_limit)return void this.$Message.warning("请选择发放数量");if(!a.route_id)return void this.$Message.warning("请选择限用路线")}}},clearSerach:function(){this.queryParams.status="",this.queryParams.route_id="",this.getTableData()},cancel:function(t){this.formLeft={},this.modal=!1,this.getTableData()},changeStatus:function(t,e,i){console.log(t),"onPutSelf"==e?this.changeStatusMethod(t,"onPutSelf"):"offSelf"==e?this.changeStatusMethod(t,"offSelf"):"delete"==e&&this.changeStatusMethod(t,"delete",i)},changeStatusMethod:function(t,e,i){var a=this,s="";"onPutSelf"==e?s="上架":"offSelf"==e?s="下架":"delete"==e&&(s="删除"),this.$Modal.confirm({title:"你确定要"+s+"编号为"+t.id+"的优惠卷吗？",okText:"确定",cancelText:"取消",onOk:function(){var e=this,i="";"上架"==s?i=2:"下架"==s?i=3:"删除"==s&&(i=4),this.$post("/admin/coupon/change-status",{id:t.id,status:i}).then(function(t){console.log(t),200==t.code?(e.$Message.info(s+"成功"),a.getTableData()):e.$Message.warning(t.error)}).catch(function(t){e.$Spin.hide()})},onCancel:function(){console.log("点击了取消删除")}})},changePage:function(t){this.page=t,this.getTableData("page")}}},l={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"new_site"},[i("div",{staticClass:"inputMsg"},[i("Select",{staticStyle:{width:"150px"},attrs:{placeholder:"状态"},model:{value:t.queryParams.status,callback:function(e){t.$set(t.queryParams,"status",e)},expression:"queryParams.status"}},t._l(t.statusList,function(e){return i("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}),1),t._v(" "),i("Select",{staticStyle:{width:"150px"},attrs:{placeholder:"可用路线"},model:{value:t.queryParams.route_id,callback:function(e){t.$set(t.queryParams,"route_id",e)},expression:"queryParams.route_id"}},t._l(t.routeList,function(e){return i("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}),1),t._v(" "),i("div",{staticClass:"btns"},[i("Button",{attrs:{type:"error"},on:{click:t.clearSerach}},[t._v("清空")]),t._v(" "),i("Button",{attrs:{type:"primary"},on:{click:t.getTableData}},[t._v("搜索")])],1)],1),t._v(" "),i("Button",{attrs:{type:"primary"},on:{click:t.newSite}},[i("Icon",{attrs:{type:"md-add"}}),t._v("新建\n    ")],1)],1),t._v(" "),i("Table",{attrs:{border:"",columns:t.columns12,data:t.data6},scopedSlots:t._u([{key:"status",fn:function(e){var a=e.row;return e.index,[1==a.status?i("div",[t._v("未上架")]):t._e(),t._v(" "),2==a.status?i("div",[t._v("上架")]):t._e(),t._v(" "),3==a.status?i("div",[t._v("已下架")]):t._e()]}},{key:"route_id",fn:function(e){var a=e.row;return e.index,t._l(t.routeList,function(e){return i("div",{key:e.value,attrs:{value:e.value}},[a.route_id==e.value?i("div",[t._v(t._s(e.label))]):t._e()])})}},{key:"is_limit",fn:function(e){var a=e.row;return e.index,[0===a.is_limit?i("div",[t._v(t._s(a.numbers))]):t._e(),t._v(" "),1===a.is_limit?i("div",[t._v("不限量")]):t._e()]}},{key:"action",fn:function(e){var a=e.row,s=e.index;return[1==a.status||3==a.status?i("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(e){return t.newSite(a)}}},[t._v("修改")]):t._e(),t._v(" "),1==a.status||3==a.status?i("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(e){return t.changeStatus(a,"onPutSelf")}}},[t._v("上架")]):t._e(),t._v(" "),2==a.status?i("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(e){return t.changeStatus(a,"offSelf")}}},[t._v("下架")]):t._e(),t._v(" "),1==a.status||3==a.status?i("Button",{attrs:{type:"error",size:"small"},on:{click:function(e){return t.changeStatus(a,"delete",s)}}},[t._v("删除")]):t._e()]}}])}),t._v(" "),i("Modal",{attrs:{title:t.modalTitle,"mask-closable":!1,closable:!1},model:{value:t.modal,callback:function(e){t.modal=e},expression:"modal"}},[i("Form",{ref:"formLeft",attrs:{model:t.formLeft,"label-position":"left","label-width":100}},[t.formLeft.id?i("FormItem",{attrs:{label:"优惠卷编号",prop:"id"}},[i("Input",{staticStyle:{width:"200px"},attrs:{disabled:""},model:{value:t.formLeft.id,callback:function(e){t.$set(t.formLeft,"id",e)},expression:"formLeft.id"}})],1):t._e(),t._v(" "),i("FormItem",{attrs:{label:"金额(分)",prop:"money",required:""}},[i("Input",{staticStyle:{width:"200px"},attrs:{maxlength:"4"},model:{value:t.formLeft.money,callback:function(e){t.$set(t.formLeft,"money",e)},expression:"formLeft.money"}})],1),t._v(" "),i("FormItem",{attrs:{label:"有效天数",prop:"validity_day",required:""}},[i("div",[i("span",[t._v("领券当日开始")]),t._v(" "),i("Input",{staticStyle:{width:"100px"},attrs:{maxlength:"4"},model:{value:t.formLeft.validity_day,callback:function(e){t.$set(t.formLeft,"validity_day",e)},expression:"formLeft.validity_day"}}),t._v(" "),i("span",[t._v("天内有效")])],1)]),t._v(" "),i("FormItem",{attrs:{label:"发放数量",prop:"is_limit",required:""}},[i("RadioGroup",{model:{value:t.formLeft.is_limit,callback:function(e){t.$set(t.formLeft,"is_limit",e)},expression:"formLeft.is_limit"}},[i("Radio",{attrs:{label:"0"}},[t._v("\n            限量\n            "),"0"===t.formLeft.is_limit?i("Input",{staticStyle:{width:"100px"},attrs:{maxlength:"4",placeholder:"限量数量"},model:{value:t.formLeft.numbers,callback:function(e){t.$set(t.formLeft,"numbers",e)},expression:"formLeft.numbers"}}):t._e()],1),t._v(" "),i("Radio",{attrs:{label:"1"}},[t._v("不限量")])],1)],1),t._v(" "),i("FormItem",{attrs:{label:"限用路线",prop:"route_id",required:""}},[i("Select",{staticStyle:{width:"150px"},attrs:{placeholder:"限用路线"},model:{value:t.formLeft.route_id,callback:function(e){t.$set(t.formLeft,"route_id",e)},expression:"formLeft.route_id"}},t._l(t.routeList,function(e){return i("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}),1)],1),t._v(" "),i("FormItem",{attrs:{label:"备注",prop:"remark"}},[i("Input",{attrs:{maxlength:"100",type:"textarea"},model:{value:t.formLeft.remark,callback:function(e){t.$set(t.formLeft,"remark",e)},expression:"formLeft.remark"}})],1)],1),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{attrs:{type:"text",size:"large"},on:{click:function(e){return t.cancel(t.modalTitle)}}},[t._v("取消")]),t._v(" "),i("Button",{attrs:{type:"primary",size:"large"},on:{click:function(e){return t.infoSure(t.modalTitle)}}},[t._v("确定")])],1)],1),t._v(" "),i("div",{staticClass:"page_box"},[i("div",{staticClass:"page_left"},[t._v("\n      共"+t._s(t.total)+"条记录 第"+t._s(t.page)+"/"+t._s(Math.ceil(t.total/t.pagesize))+"页\n    ")]),t._v(" "),i("div",{staticClass:"page_right"},[i("Page",{attrs:{total:t.total,"page-size":t.pagesize,current:t.page},on:{"on-change":t.changePage}})],1)])],1)},staticRenderFns:[]};var u=i("VU/8")(o,l,!1,function(t){i("fMrZ")},"data-v-8c60469c",null);e.default=u.exports}});
//# sourceMappingURL=26.049641797f91d60bd660.js.map