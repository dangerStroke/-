webpackJsonp([45],{FOwu:function(t,e){},rlI6:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s={name:"recommend",data:function(){return{packList:[],selectPack:[],timevalue:"",numbers:"",isDisabled:!0,start_date:"",end_date:"",isDataNull:!1,selectPackid:[],idEdit:!1}},created:function(){this.$Spin.show(),this.getCouponList()},methods:{getRegisterActivity:function(){var t=this;this.$fetch("/admin/recommend-activity/list").then(function(e){if(console.log(e),console.log(123),200==e.code)if(e.data.id){t.isDataNull=!0,t.timevalue=e.data.start_date+" - "+e.data.end_date,t.start_date=e.data.start_date,t.end_date=e.data.end_date;var i=[],s=[];JSON.parse(e.data.coupon).map(function(e,a){t.packList.map(function(t,a){e.coupon_id==t.id&&(i.push(e),s.push(e.coupon_id),t.numbers=e.numbers,t.checked=!0)})}),t.selectPack=s,t.packList.map(function(t){t.checked||(t.numbers=null)})}else t.isDataNull=!1;else t.$Message.warning(e.error)}).catch(function(e){t.$Spin.hide()})},getCouponList:function(){var t=this;this.$fetch("/admin/coupon/list",{page:1,page_size:1e4,status:-1,route_id:0}).then(function(e){console.log(e),t.$Spin.hide();var i=[],s=e.data.ret.map(function(t){return 2==t.status&&i.push(t),i});t.packList=s[0],t.getRegisterActivity(),t.selectPack=t.packList,console.log(t.selectPack)})},changeGroup:function(t){console.log(t)},selectTime:function(t){console.log(t),this.start_date=this.getTimeMe(t[0]),this.end_date=this.getTimeMe(t[1])},getTimeMe:function(t){var e=new Date(t);return e.getFullYear()+"-"+this.p(e.getMonth()+1)+"-"+this.p(e.getDate())+" "+(this.p(e.getHours())+":"+this.p(e.getMinutes())+":"+this.p(e.getSeconds()))},p:function(t){return t<10?"0"+t:t},editPack:function(){var t=this;this.$Modal.confirm({title:"你确定修改礼包？修改后注册的用户礼包将更新",onOk:function(){t.isDisabled=!1,t.idEdit=!0,t.isDataNull=!1},onCancel:function(){t.isDisabled=!0,t.idEdit=!1}})},sureEditPack:function(){var t=this,e=this,i=[];if(console.log(this.selectPack),console.log(this.packList),this.packList.map(function(e,s){t.selectPack.map(function(t,s){if(e.id===t){var a={coupon_id:e.id,numbers:Number(e.numbers)};i.push(a)}})}),console.log(this.start_date),console.log(this.end_date),console.log(i),i.length>5)this.$Message.warning("最多只能选择5种优惠卷");else if(this.start_date&&this.end_date&&i.length>0){var s=[];if(i.map(function(t,e){s.push(Number(t.numbers))}),!s.every(function(t,e){return t>0}))return void this.$Message.warning("请输入每人限领的优惠卷数量>=1");console.log("可以发请求"),console.log(i),this.$post("/admin/recommend-activity/save",{start_date:this.start_date,end_date:this.end_date,coupon:i}).then(function(i){console.log(i),200==i.code&&(t.$Message.info("操作成功"),t.getRegisterActivity(),e.isDisabled=!0,t.idEdit=!1)}).catch(function(e){t.$Spin.hide()})}else{if(!this.start_date)return void this.$Message.warning("请选择开始日期");if(!this.end_date)return void this.$Message.warning("请选择结束日期");if(0===i.length)return void this.$Message.warning("请选择优惠礼包")}},cancel:function(){this.isDisabled=!0,this.getRegisterActivity(),this.idEdit=!1},clearTime:function(){this.start_date="",this.end_date=""}}},a={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"content"},[i("p",[t._v("推荐有礼活动配置")]),t._v(" "),i("div",{staticClass:"main"},[i("div",{staticClass:"main_item"},[i("span",[t._v("活动日期:")]),t._v(" "),i("DatePicker",{staticStyle:{width:"300px"},attrs:{type:"datetimerange",format:"yyyy-MM-dd HH:mm",placeholder:"选择日期",confirm:!0,disabled:t.isDisabled,clearable:!1},on:{"on-ok":function(e){return t.selectTime(t.timevalue)},"on-clear":t.clearTime},model:{value:t.timevalue,callback:function(e){t.timevalue=e},expression:"timevalue"}})],1),t._v(" "),t._m(0),t._v(" "),i("div",{staticClass:"main_item checkboxcss"},[i("span",[t._v("优惠礼包:")]),t._v(" "),t.packList.length<=0?i("h2",{staticStyle:{"padding-left":"70px"}},[t._v("暂无上架礼包，请先上架礼包再配置活动")]):i("CheckboxGroup",{model:{value:t.selectPack,callback:function(e){t.selectPack=e},expression:"selectPack"}},t._l(t.packList,function(e,s){return i("Checkbox",{key:e.id,attrs:{disabled:t.isDisabled,label:e.id}},[t._v("\n          优惠卷编号"),i("b",[t._v(t._s(e.id))]),t._v(",面值"),i("b",[t._v(t._s(e.money))]),t._v("(分)\n          "),i("Input",{staticClass:"coupon_num",attrs:{type:"number",maxlength:"1",placeholder:"券数量",disabled:t.isDisabled},model:{value:e.numbers,callback:function(i){t.$set(e,"numbers",i)},expression:"item.numbers"}})],1)}),1)],1),t._v(" "),i("div",{staticClass:"main_item main_item_btn"},[t.isDataNull||t.idEdit?t._e():i("Button",{staticStyle:{float:"left"},attrs:{type:"primary"},on:{click:t.editPack}},[t._v("添加推荐有礼活动")]),t._v(" "),t.isDataNull?i("Button",{attrs:{type:"primary"},on:{click:t.editPack}},[t._v("修改")]):i("div",[i("Button",{attrs:{type:"error"},on:{click:t.cancel}},[t._v("取消")]),t._v(" "),i("Button",{attrs:{type:"primary"},on:{click:t.sureEditPack}},[t._v("保存")])],1)],1)])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"main_item"},[e("span",[this._v("发放人群:")]),this._v(" "),e("b",[this._v("推荐成功（凡每次推荐新用户注册并30天内下单的用户）")])])}]};var n=i("VU/8")(s,a,!1,function(t){i("FOwu")},"data-v-22cc5533",null);e.default=n.exports}});
//# sourceMappingURL=45.dea7b98a9d51b73f58e2.js.map