webpackJsonp([13],{"4Ylk":function(e,t){},H4jC:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("fZjL"),i=r.n(a),n=r("bOdI"),s=r.n(n),o=(r("4Ylk"),{name:"driver",data:function(){var e;return e={columns:[{title:"状态",slot:"status",align:"center"},{title:"司机编号",key:"id",align:"center"},{title:"司机角色",slot:"role_id",align:"center"},{title:"司机类型",slot:"type",align:"center"},{title:"司机姓名",key:"name",align:"center"},{title:"司机手机号",key:"phone",align:"center"},{title:"司机授权码",key:"invitation_code",align:"center"},{title:"操作",slot:"action",width:150,align:"center"}],data:[],modal:!1,formLeft:{},name:"",phoneNumber:"",idCard:"",carNumber:"",statusDropdown:"状态",modalTitle:"",page:1,pagesize:10,total:0,driverPic:"",driverLicense:"",queryParams:{name:"",phoneNumber:"",idCard:"",model1:""},statusList:[{value:"全部",label:"全部"},{value:"启用",label:"启用"},{value:"停用",label:"停用"}]},s()(e,"name",""),s()(e,"phoneNumber",""),s()(e,"idCard",""),s()(e,"model1",""),s()(e,"uploadDriverImgUrl",""),s()(e,"uploadXszImgUrl",""),s()(e,"roleId",""),s()(e,"roleList",[]),s()(e,"siteList",[]),s()(e,"bigKindList",[{value:1,label:"城际接送"},{value:2,label:"司乘快客"},{value:7,label:"直通车"}]),s()(e,"isMainList",[{value:1,label:"主司机"},{value:0,label:"副司机"}]),e},watch:{},created:function(){this.$Spin.show(),this.getDriverDataList(),this.getRoleId(),this.getSite()},methods:{getRoleId:function(){var e=this,t=this;this.$fetch("/admin/index/select-driver-role").then(function(e){if(console.log(e),200==e.code){var r=i()(e.data).map(function(t,r){return{value:t,label:e.data[t]}});t.roleList=r,console.log(r)}else t.$Message.warning(e.error)}).catch(function(t){e.$Spin.hide()})},getSite:function(){var e=this,t=this;this.$fetch("/admin/citytransport/list-station").then(function(e){if(console.log(e.data.data),200==e.code){var r=e.data.data.map(function(e){var t=e.id;return{label:e.name,value:t}});console.log(r),t.siteList=r}else t.$Message.warning(e.error)}).catch(function(t){e.$Spin.hide()})},clearSerach:function(){this.name="",this.phoneNumber="",this.idCard="",this.model1="",this.getDriverDataList()},getDriverDataList:function(e){var t=this,r="";r="停用"==this.model1?0:"启用"==this.model1?1:(this.model1,-1),"page"!==e&&(this.page=1);var a={page:this.page,pagesize:this.pagesize,name:this.name||"",phone:this.phoneNumber||"",id_card_number:this.idCard||"",status:r};this.$fetch("/admin/dispatch/list-driver",a).then(function(e){if(t.$Spin.hide(),200===e.code){console.log(e);var r=e.data.data;t.data=r,t.total=e.data.total}else t.$Message.warning(e.error)}).catch(function(e){t.$Spin.hide()})},statusBtn:function(e){var t=this;console.log(e.status);var r="";r=0==e.status?"启用":"停用",console.log(r),this.$Modal.confirm({title:"你确定要"+r+"该司机吗？",okText:"确定",cancelText:"取消",onOk:function(){var r=this,a="";0==e.status?a=1:1==e.status&&(a=0),this.$fetch("/admin/dispatch/edit-driver",{id:e.id,status:a}).then(function(e){console.log(e),200==e.code?(t.$Message.info("修改状态成功"),t.getDriverDataList()):t.$Message.warning(e.error)}).catch(function(e){r.$Spin.hide()})},onCancel:function(){console.log("点击了取消删除")}})},newSite:function(e){var t=this;this.modal=!0,e.id?(this.modalTitle="修改司机",this.$fetch("/admin/dispatch/get-driver",{id:e.id}).then(function(e){if(console.log(e.data),200==e.code){t.formLeft=e.data;var r=e.data.id_card_number,a=r.substring(6,10)+"-"+r.substring(10,12)+"-"+r.substring(12,14);t.formLeft.driverBirthDay=a,t.uploadDriverImgUrl=e.data.driver_license_img,t.uploadXszImgUrl=e.data.selfie_img,t.formLeft.role_id=t.formLeft.role_id.toString()}else t.$Message.warning(e.error)}).catch(function(e){t.$Spin.hide()})):(this.modalTitle="新建司机",this.formLeft={},this.uploadDriverImgUrl="",this.uploadXszImgUrl="",this.formLeft.role_id="")},handleUploadiconDriver:function(e){var t=this;this.$uploadImg(e,function(e){t.uploadDriverImgUrl=e})},handleUploadiconXsz:function(e){var t=this;this.$uploadImg(e,function(e){t.uploadXszImgUrl=e})},handleFormatError1:function(e){this.$Message.info("图片格式不正确,请上传正确的图片格式")},validate:function(e,t){if("phone"==e){if(""==t)return this.$Message.error("手机号码不能为空！"),!1;if(!/^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1}))+\d{8})$/.test(t))return this.$Message.error("请输入有效的手机号码！"),!1}else if("id_card_number"==e){if(""==t)return this.$Message.error("请输入身份证号！"),!1;if(!/^[1-9]{1}[0-9]{14}$|^[1-9]{1}[0-9]{16}([0-9]|[xX])$/.test(t))return this.$Message.error("身份证号有误，请重新输入"),!1;var r=t.substring(6,10)+"-"+t.substring(10,12)+"-"+t.substring(12,14);this.formLeft.driverBirthDay=r}else if("bank_card"==e){if(""==t)return this.$Message.error("请输入银行卡号！"),!1;if(!/^([1-9]{1})(\d{15}|\d{18})$/.test(t))return this.$Message.error("银行卡号有误，请重新输入"),!1}},infoSure:function(e){var t=this;if("新建司机"==e){var r=this.formLeft;console.log(r.park_id),console.log(r.type),2==r.type&&(r.is_main_driver=1),console.log(r.is_main_driver);var a=this.uploadDriverImgUrl,i=this.uploadXszImgUrl;if(r.name&&r.gender&&r.phone&&r.id_card_number&&r.addr&&r.wechat&&r.type&&a&&i){var n=r.phone.toString(),s=r.id_card_number.toString();this.$post("/admin/dispatch/add-driver",{phone:n,name:r.name,status:r.status,gender:r.gender,id_card_number:s,role_id:r.role_id,addr:r.addr,wechat:r.wechat,bank_card:r.bank_card,bank_name:r.bank_name,comment:r.comment,selfie_img:a,driver_license_img:i,type:r.type,is_main_driver:r.is_main_driver,park_id:r.park_id}).then(function(e){console.log(e),200==e.code?(t.$Message.info("新增司机成功"),t.modal=!1,t.getDriverDataList(),t.formLeft={}):t.$Message.warning(e.error)}).catch(function(e){t.$Spin.hide()})}else{if(!a)return void this.$Message.error("请上传司机照片");if(!i)return void this.$Message.error("请上传驾驶证照片");if(!r.name)return void this.$Message.error("请输入姓名");if(!r.status)return void this.$Message.error("请选择司机状态");if(!r.gender)return void this.$Message.error("请选择性别");if(!r.role_id)return void this.$Message.error("请选择司机角色");if(!r.addr)return void this.$Message.error("请填写家庭住址");if(!r.wechat)return void this.$Message.error("请填写微信号");if(!a)return void this.$Message.error("请上传司机照片");if(!i)return void this.$Message.error("请上传驾驶证照片");if(!r.type)return void this.$Message.error("请选择司机类型");if(!r.is_main_driver)return void this.$Message.error("请选择主司机")}}else"修改司机"==e&&this.editInfo(this.formLeft,this.formLeft.status)},editInfo:function(e,t){var r=this,a=e,i=this.uploadDriverImgUrl,n=this.uploadXszImgUrl;if(2==a.type&&(a.is_main_driver=1),console.log(a.is_main_driver),a.name&&a.gender&&a.phone&&a.id_card_number&&a.addr&&a.wechat&&i&&n&&a.type){var s=a.phone.toString(),o=a.id_card_number.toString();this.$post("/admin/dispatch/edit-driver",{id:a.id,phone:s,name:a.name,status:t,gender:a.gender,id_card_number:o,role_id:a.role_id,addr:a.addr,wechat:a.wechat,bank_card:a.bank_card,bank_name:a.bank_name,comment:a.comment,selfie_img:i,driver_license_img:n,is_main_driver:a.is_main_driver,type:a.type,park_id:a.park_id}).then(function(e){console.log("修改司机成功"),200==e.code?(r.$Message.info("修改司机成功"),r.modal=!1,r.getDriverDataList(),r.formLeft={}):r.$Message.warning(e.error)}).catch(function(e){r.$Spin.hide()})}else{if(!a.name)return void this.$Message.error("请输入姓名");if(!a.gender)return void this.$Message.error("请选择性别");if(!a.role_id)return void this.$Message.error("请选择司机角色");if(!a.addr)return void this.$Message.error("请填写家庭住址");if(!a.wechat)return void this.$Message.error("请填写微信号");if(!a.type)return void this.$Message.error("请选择司机类型");a.is_main_driver||this.$Message.error("请选择主司机")}},cancel:function(e){console.log("取消",e),this.modal=!1,this.formLeft={},console.log(this.formLeft),this.uploadDriverImgUrl="",this.uploadXszImgUrl=""},changePage:function(e){this.page=e,this.getDriverDataList("page")}}}),l={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"driver_css"},[r("div",{staticClass:"new_site"},[r("div",{staticClass:"inputMsg"},[r("Input",{attrs:{type:"text",placeholder:"搜索姓名"},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}),e._v(" "),r("Input",{attrs:{type:"number",placeholder:"搜索手机号"},model:{value:e.phoneNumber,callback:function(t){e.phoneNumber=t},expression:"phoneNumber"}}),e._v(" "),r("Input",{attrs:{placeholder:"搜索身份证号"},model:{value:e.idCard,callback:function(t){e.idCard=t},expression:"idCard"}}),e._v(" "),r("Select",{staticStyle:{width:"150px"},attrs:{placeholder:"选择司机状态"},model:{value:e.model1,callback:function(t){e.model1=t},expression:"model1"}},e._l(e.statusList,function(t){return r("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])}),1)],1),e._v(" "),r("div",{staticClass:"btns"},[r("Button",{attrs:{type:"primary"},on:{click:e.getDriverDataList}},[e._v("搜索")]),e._v(" "),r("Button",{attrs:{type:"error"},on:{click:e.clearSerach}},[e._v("清空")]),e._v(" "),r("Button",{staticClass:"newBtn",attrs:{type:"primary"},on:{click:e.newSite}},[r("Icon",{attrs:{type:"md-add"}}),e._v("新建\n      ")],1)],1)]),e._v(" "),r("Table",{attrs:{border:"",columns:e.columns,data:e.data},scopedSlots:e._u([{key:"status",fn:function(t){var r=t.row;return t.index,[e._v(e._s(0==r.status?"停用":"启用"))]}},{key:"role_id",fn:function(t){var a=t.row;return t.index,e._l(e.roleList,function(t){return r("div",{key:t.value,attrs:{value:t.value}},[a.role_id==t.value?r("div",[e._v(e._s(t.label))]):e._e()])})}},{key:"type",fn:function(t){var a=t.row;return t.index,e._l(e.bigKindList,function(t){return r("div",{key:t.value,attrs:{value:t.value}},[a.type==t.value?r("div",[e._v("\n          "+e._s(t.label)+"\n          "),1==a.type?r("div",[0==a.is_main_driver?r("span",[e._v("(副司机)")]):e._e(),e._v(" "),1==a.is_main_driver?r("span",[e._v("(主司机)")]):e._e()]):e._e()]):e._e()])})}},{key:"action",fn:function(t){var a=t.row;return t.index,[r("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(t){return e.newSite(a)}}},[e._v("修改")]),e._v(" "),r("Button",{attrs:{type:"error",size:"small"},on:{click:function(t){return e.statusBtn(a)}}},[e._v(e._s(0==a.status?"启用":"停用"))])]}}])}),e._v(" "),r("div",{staticClass:"driver_model"},[r("Modal",{attrs:{title:e.modalTitle,transfer:!1,"mask-closable":!1,closable:!1},model:{value:e.modal,callback:function(t){e.modal=t},expression:"modal"}},[r("Form",{ref:"formLeft",attrs:{model:e.formLeft,"label-position":"left","label-width":100}},[r("FormItem",{attrs:{label:"司机照片:",prop:"driverPic",required:""}},[r("Upload",{ref:"upload",staticStyle:{display:"inline-block"},attrs:{"show-upload-list":!1,format:["jpg","jpeg","png"],"max-size":2048,"on-format-error":e.handleFormatError1,"before-upload":e.handleUploadiconDriver,multiple:"",type:"drag",name:"file",action:""}},[r("div",{staticStyle:{width:"130px",height:"100px"}},[r("img",{staticClass:"upload_img_css",attrs:{src:e.uploadDriverImgUrl,alt:""}})])])],1),e._v(" "),r("FormItem",{attrs:{label:"驾驶证照片:",prop:"driverLicense",required:""}},[r("Upload",{ref:"upload",staticStyle:{display:"inline-block"},attrs:{"show-upload-list":!1,format:["jpg","jpeg","png"],"max-size":2048,"on-format-error":e.handleFormatError1,"before-upload":e.handleUploadiconXsz,multiple:"",type:"drag",name:"file",action:""}},[r("div",{staticStyle:{width:"130px",height:"100px"}},[r("img",{staticClass:"upload_img_css",attrs:{src:e.uploadXszImgUrl,alt:""}})])])],1),e._v(" "),r("FormItem",{attrs:{label:"司机状态",prop:"status",required:""}},[r("RadioGroup",{staticClass:"sex_class",model:{value:e.formLeft.status,callback:function(t){e.$set(e.formLeft,"status",t)},expression:"formLeft.status"}},[r("Radio",{attrs:{label:0}},[e._v("停用")]),e._v(" "),r("Radio",{attrs:{label:1}},[e._v("启用")])],1)],1),e._v(" "),r("FormItem",{attrs:{label:"司机姓名",prop:"name",required:""}},[r("Input",{attrs:{maxlength:"10"},model:{value:e.formLeft.name,callback:function(t){e.$set(e.formLeft,"name",t)},expression:"formLeft.name"}})],1),e._v(" "),r("FormItem",{attrs:{label:"性别",prop:"gender",required:""}},[r("RadioGroup",{staticClass:"sex_class",model:{value:e.formLeft.gender,callback:function(t){e.$set(e.formLeft,"gender",t)},expression:"formLeft.gender"}},[r("Radio",{attrs:{label:2}},[e._v("男")]),e._v(" "),r("Radio",{attrs:{label:1}},[e._v("女")])],1)],1),e._v(" "),r("FormItem",{attrs:{label:"司机类型",prop:"type",required:""}},[r("Select",{staticStyle:{width:"150px",float:"left"},model:{value:e.formLeft.type,callback:function(t){e.$set(e.formLeft,"type",t)},expression:"formLeft.type"}},e._l(e.bigKindList,function(t){return r("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])}),1),e._v(" "),1==e.formLeft.type?r("Select",{staticStyle:{width:"100px",float:"left","margin-left":"20px"},model:{value:e.formLeft.is_main_driver,callback:function(t){e.$set(e.formLeft,"is_main_driver",t)},expression:"formLeft.is_main_driver"}},e._l(e.isMainList,function(t){return r("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])}),1):e._e()],1),e._v(" "),r("FormItem",{attrs:{label:"司机电话号码",prop:"phone",required:""}},[r("Input",{attrs:{type:"number"},on:{"on-blur":function(t){return e.validate("phone",e.formLeft.phone)}},model:{value:e.formLeft.phone,callback:function(t){e.$set(e.formLeft,"phone",t)},expression:"formLeft.phone"}})],1),e._v(" "),r("FormItem",{attrs:{label:"司机身份证号",prop:"id_card_number",required:""}},[r("Input",{on:{"on-blur":function(t){return e.validate("id_card_number",e.formLeft.id_card_number)}},model:{value:e.formLeft.id_card_number,callback:function(t){e.$set(e.formLeft,"id_card_number",t)},expression:"formLeft.id_card_number"}})],1),e._v(" "),r("FormItem",{attrs:{label:"司机生日",prop:"driverBirthDay"}},[r("Input",{attrs:{type:"text",disabled:""},model:{value:e.formLeft.driverBirthDay,callback:function(t){e.$set(e.formLeft,"driverBirthDay",t)},expression:"formLeft.driverBirthDay"}})],1),e._v(" "),r("FormItem",{attrs:{label:"司机角色",prop:"role_id",required:""}},[r("Select",{staticClass:"sex_class",model:{value:e.formLeft.role_id,callback:function(t){e.$set(e.formLeft,"role_id",t)},expression:"formLeft.role_id"}},e._l(e.roleList,function(t){return r("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])}),1)],1),e._v(" "),r("FormItem",{attrs:{label:"起始站点",prop:"park_id",required:""}},[r("Select",{staticClass:"sex_class",model:{value:e.formLeft.park_id,callback:function(t){e.$set(e.formLeft,"park_id",t)},expression:"formLeft.park_id"}},e._l(e.siteList,function(t){return r("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])}),1)],1),e._v(" "),r("FormItem",{attrs:{label:"家庭住址",prop:"addr",required:""}},[r("Input",{attrs:{maxlength:"30"},model:{value:e.formLeft.addr,callback:function(t){e.$set(e.formLeft,"addr",t)},expression:"formLeft.addr"}})],1),e._v(" "),r("FormItem",{attrs:{label:"微信号",prop:"wechat",required:""}},[r("Input",{attrs:{maxlength:"20"},model:{value:e.formLeft.wechat,callback:function(t){e.$set(e.formLeft,"wechat",t)},expression:"formLeft.wechat"}})],1),e._v(" "),r("FormItem",{attrs:{label:"银行卡账户",prop:"bank_card"}},[r("Input",{attrs:{type:"number"},on:{"on-blur":function(t){return e.validate("bankCard",e.formLeft.bank_card)}},model:{value:e.formLeft.bank_card,callback:function(t){e.$set(e.formLeft,"bank_card",t)},expression:"formLeft.bank_card"}})],1),e._v(" "),r("FormItem",{attrs:{label:"银行卡开户行",prop:"bank_name"}},[r("RadioGroup",{staticClass:"sex_class",model:{value:e.formLeft.bank_name,callback:function(t){e.$set(e.formLeft,"bank_name",t)},expression:"formLeft.bank_name"}},[r("Radio",{attrs:{label:"chinaGsBank"}},[e._v("中国工商银行")]),e._v(" "),r("Radio",{attrs:{label:"chinaNyBank"}},[e._v("中国农业银行")]),e._v(" "),r("Radio",{attrs:{label:"chinaNsBank"}},[e._v("中国农商银行")]),e._v(" "),r("Radio",{attrs:{label:"chinaZsBank"}},[e._v("中国招商银行")]),e._v(" "),r("Radio",{attrs:{label:"chinaYzBank"}},[e._v("中国邮政银行")])],1)],1),e._v(" "),r("FormItem",{attrs:{label:"备注",prop:"comment"}},[r("Input",{attrs:{maxlength:"100",type:"textarea"},model:{value:e.formLeft.comment,callback:function(t){e.$set(e.formLeft,"comment",t)},expression:"formLeft.comment"}})],1)],1),e._v(" "),r("div",{attrs:{slot:"footer"},slot:"footer"},[r("Button",{attrs:{type:"text",size:"large"},on:{click:function(t){return e.cancel(e.modalTitle)}}},[e._v("取消")]),e._v(" "),r("Button",{attrs:{type:"primary",size:"large"},on:{click:function(t){return e.infoSure(e.modalTitle)}}},[e._v("确定")])],1)],1)],1),e._v(" "),r("div",{staticClass:"page_box"},[r("div",{staticClass:"page_left"},[e._v("\n      共"+e._s(e.total)+"条记录 第"+e._s(e.page)+"/"+e._s(Math.ceil(e.total/e.pagesize))+"页\n    ")]),e._v(" "),r("div",{staticClass:"page_right"},[r("Page",{attrs:{total:e.total,"page-size":e.pagesize,current:e.page},on:{"on-change":e.changePage}})],1)])],1)},staticRenderFns:[]};var d=r("VU/8")(o,l,!1,function(e){r("RRA0")},"data-v-1e0c861a",null);t.default=d.exports},RRA0:function(e,t){}});
//# sourceMappingURL=13.9311a8d56bab0feb47b3.js.map