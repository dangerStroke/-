webpackJsonp([14],{EdSP:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("Dd8w"),s=i.n(a),o=(i("P9l9"),i("YW59"),i("mtWM")),n=i.n(o),r={data:function(){return{columns12:[{title:"操作",slot:"action",align:"center",width:200},{title:"序号",key:"num",align:"center",width:70},{title:"订单类型",key:"orderType",align:"center",width:100},{title:"订单状态",key:"status",align:"center",width:100},{title:"支付标识",key:"payType",align:"center",width:100},{title:"订单编号",key:"orderNum",align:"center",tooltip:!0,width:165},{title:"线路",key:"line",align:"center",width:130},{title:"预定人",key:"user_name",align:"center",width:100},{title:"乘车人",key:"name",align:"center",width:100},{title:"乘客电话",key:"userTel",align:"center",tooltip:!0,width:130},{title:"发车日期",key:"date",align:"center",width:115},{title:"发出时间",key:"time",align:"center",width:100},{title:"司机",key:"driverName",align:"center",width:110},{title:"车牌号",key:"carNum",align:"center",width:110},{title:"乘车人数",key:"userNum",align:"center",width:80}],data6:[],columns15:[{title:"类目",key:"name"},{title:"金额",key:"price"},{title:"司机佣金",key:"commission"}],data11:[],modal1:!1,line:"",date:"",status:-1,order:"",orderTime:"",carName:"",orderId:"",carId:"",lineList:[],dateList:[],start_station_id:"",end_station_id:"",driver_id:"",orderType:[{value:"已取消",label:"已取消"},{value:"待出行",label:"待出行"},{value:"已完成",label:"已完成"},{value:"改签成功",label:"改签成功"},{value:"已支付",label:"已支付"},{value:"未支付",label:"未支付"},{value:"退票",label:"退票"}],orderDate:[],orderList:[],page:1,pagesize:10,total:0,detailInfo:"",cityList:[],route_id:"",book_name:""}},methods:{show:function(t){var e=this;this.modal1=!0,this.$fetch("/admin/order/detail",{order_id:this.orderList[t].id}).then(function(t){if(200===t.code){console.log(t),e.detailInfo=t.data,0!==e.detailInfo.cancel_time?e.detailInfo.cancel_time=e.timestampToTime(e.detailInfo.cancel_time):0!==e.detailInfo.refund_time&&(e.detailInfo.refund_time=e.timestampToTime(e.detailInfo.refund_time)),0!==e.detailInfo.change_ticket_time&&(e.detailInfo.change_ticket_time=e.timestampToTime(e.detailInfo.change_ticket_time)),e.detailInfo.ticket_time=e.timestampToTime(e.detailInfo.ticket_time),1==e.detailInfo.status?(e.detailInfo.status="未支付",e.detailInfo.orderType="未支付"):3==e.detailInfo.status||2==e.detailInfo.status?(e.detailInfo.status="待出行",e.detailInfo.orderType="已支付"):9==e.detailInfo.status?(e.detailInfo.status="已完成",e.detailInfo.orderType="已支付"):8==e.detailInfo.status?(e.detailInfo.status="订单已取消",e.detailInfo.orderType="未支付"):6==e.detailInfo.status?(e.detailInfo.status="改签成功",e.detailInfo.orderType="已支付"):5==e.detailInfo.status?(e.detailInfo.status="已退票",e.detailInfo.orderType="未支付"):11===e.detailInfo.status&&(e.detailInfo.status="已完成",e.detailInfo.orderType="已支付");var i=[];t.data.order.forEach(function(t){console.log(t),t.commission=(t.commission/100).toFixed(2),t.price=(t.price/100).toFixed(2),i.push(t)}),e.data11=i}}).catch(function(t){e.$Spin.hide()})},remove:function(t){var e=this;console.log(t),console.log(this.orderList),2==this.orderList[t].status||6==this.orderList[t].status?0!=this.orderList[t].price_pay?(console.log(this.orderList[t]),this.$Modal.confirm({content:"你确定要删除该订单?<br>若确定取消,该订单金额将全部退还",onOk:function(){var i={order_sn:String(e.orderList[t].order_sn),uid:String(e.orderList[t].uid)};e.$fetch("/admin/order/refund",i).then(function(t){200==t.code?(e.getOrderList(),e.$Message.success({content:"订单取消成功",duration:2})):e.$Message.error({content:t.error,duration:2})}).catch(function(t){e.$Spin.hide()})}})):(console.log(this.orderList[t]),this.$Modal.confirm({content:"你确定要删除该订单?",onOk:function(){var i={order_sn:String(e.orderList[t].order_sn),uid:String(e.orderList[t].uid),is_free:1};e.$fetch("/admin/order/cancel",i).then(function(t){200==t.code?(e.getOrderList(),e.$Message.success({content:"订单取消成功",duration:2})):e.$Message.error({content:t.error,duration:2})}).catch(function(t){e.$Spin.hide()})}})):8==this.orderList[t].status||5==this.orderList[t].status?this.$Message.error({content:"订单已取消",duration:2}):1==this.orderList[t].status&&this.$Modal.confirm({content:"你确定要删除该订单?",onOk:function(){var i={order_sn:String(e.orderList[t].order_sn)};e.$fetch("/admin/order/cancel",i).then(function(t){200==t.code?e.$Message.success({content:"订单取消成功",duration:2}):e.$Message.error({content:t.error,duration:2})}).catch(function(t){e.$Spin.hide()})}})},clean:function(){this.line="",this.order="",this.orderId="",this.carId="",this.carName="",this.status=-1,this.date="",this.orderTime="",this.page=1,this.lineId=-1,this.route_id="",this.driver_id="",this.book_name="",this.getOrderList(),this.getLine()},search:function(){var t=this,e=this.carName;""!=e?this.$fetch("/admin/dispatch/list-driver",{methods:"POST",name:e}).then(function(e){console.log(e),200==e.code&&e.data.data.length>0&&(t.driver_id=e.data.data[0].id,console.log(t.driver_id)),t.data6=[],t.getOrderList()}):(this.data6=[],this.getOrderList())},lineChange:function(t){void 0!==t&&(this.route_id=t.split(":")[0])},dateChange:function(t){this.date=t},orderTypeChange:function(t){"已取消"==t?this.status=8:"待出行"==t?this.status=3:"已完成"==t?this.status=9:"改签成功"==t?this.status=6:"未支付"==t?this.status=1:"退票"==t?this.status=5:"已支付"==t&&(this.status=2)},orderDateChange:function(t){this.orderTime=t},changePage:function(t){this.page=t,this.getOrderList("page")},getOrderList:function(t){var e=this;"page"!==t&&(this.page=1);var i={page:this.page,page_size:this.pagesize,status:this.status,route_id:this.route_id,date:this.date,created_at:this.orderTime,order_sn:this.orderId,driver_id:this.driver_id,name:this.book_name};this.$fetch("/admin/order/get-order",i).then(function(t){if(e.$Spin.hide(),200===t.code){e.data6=[];var i=t.data.ret;e.orderList=i,e.total=t.data.total,e.orderList.forEach(function(t,i){2==t.status&&(t.status_text="待出行");var a={num:i+1,orderType:t.type,status:t.status_text,payType:t.pay,orderNum:t.order_sn,line:t.from+"-"+t.to,name:t.name,userTel:t.phone,date:t.start_at.split(" ")[0],time:t.start_at.split(" ")[1],driverName:t.driver_name,carNum:t.car_no,user_name:t.user_name,userNum:t.adult_numbers+"人"};e.data6.push(a)})}else e.$Message.warning("暂无数据")}).catch(function(t){e.$Spin.hide()})},timestampToTime:function(t){var e=new Date(1e3*t);return e.getFullYear()+"-"+((e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-")+((e.getDate()<10?"0"+e.getDate():e.getDate())+" ")+((e.getHours()<10?"0"+e.getHours():e.getHours())+":")+((e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":")+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())},getLine:function(){var t=this;this.$fetch("/admin/index/select-route").then(function(e){if(200==e.code)for(var i in e.data){var a={value:i+":"+e.data[i],label:e.data[i]};t.lineList.push(a)}else t.$Message.error({content:e.error,duration:2})}).catch(function(e){t.$Spin.hide()})},subExcel:function(){var t={page:1,page_size:9999999,status:this.status,route_id:this.route_id,date:this.date,created_at:this.orderTime,order_sn:this.orderId,driver_id:this.driver_id,name:this.book_name},e="",i=window.location.host;e="localhost:8080"==i||"dev-admin.jd-gz.com"==i?"http://dev.jd-gz.com/admin/order/get-order-excel":"admin.jd-gz.com"==i?"http://api.jd-gz.com/admin/order/get-order-excel":"http://adminlocal/admin/order/get-order-excel",n.a.post(e,s()({},t),{responseType:"blob"}).then(function(t){var e=t.data,i=new FileReader;i.readAsDataURL(e),i.onload=function(t){var e=document.createElement("a");e.download="城际订单报表.xls",e.href=t.target.result,document.body.appendChild(e),e.click(),document.body.removeChild(e)}}).catch(function(t){console.log(t.message)})}},created:function(){this.$Spin.show(),this.getOrderList(),this.getLine()}},d={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"wrap"},[i("div",{staticClass:"searchBox"},[i("div",{staticClass:"boxList"},[i("Select",{staticClass:"searchBox1",staticStyle:{width:"200px"},attrs:{placeholder:"选择线路",value:"dsadgash"},on:{"on-change":t.lineChange},model:{value:t.line,callback:function(e){t.line=e},expression:"line"}},t._l(t.lineList,function(e,a){return i("Option",{key:a,attrs:{value:e.value}},[t._v(t._s(e.label))])}),1),t._v(" "),i("DatePicker",{staticClass:"searchBox1",staticStyle:{width:"200px"},attrs:{type:"date",placeholder:"发车日期",placement:"bottom-end",value:t.date},on:{"on-change":t.dateChange}})],1),t._v(" "),i("div",{staticClass:"boxList"},[i("Select",{staticClass:"searchBox1",staticStyle:{width:"200px"},attrs:{placeholder:"订单状态"},on:{"on-change":t.orderTypeChange},model:{value:t.order,callback:function(e){t.order=e},expression:"order"}},t._l(t.orderType,function(e,a){return i("Option",{key:a,attrs:{value:e.value}},[t._v(t._s(e.label))])}),1),t._v(" "),i("DatePicker",{staticClass:"searchBox1",staticStyle:{width:"200px"},attrs:{type:"date",placeholder:"订单创建时间",placement:"bottom-end",value:t.orderTime},on:{"on-change":t.orderDateChange}})],1),t._v(" "),i("div",{staticClass:"boxList"},[i("Input",{staticClass:"searchBox1",staticStyle:{width:"200px"},attrs:{placeholder:"订单编号"},model:{value:t.orderId,callback:function(e){t.orderId=e},expression:"orderId"}}),t._v(" "),i("Input",{staticClass:"searchBox1",staticStyle:{width:"200px"},attrs:{placeholder:"车牌号"},model:{value:t.carId,callback:function(e){t.carId=e},expression:"carId"}})],1),t._v(" "),i("div",{staticClass:"boxList lastList"},[i("Input",{staticClass:"searchBox1",staticStyle:{width:"200px"},attrs:{placeholder:"司机"},model:{value:t.carName,callback:function(e){t.carName=e},expression:"carName"}}),t._v(" "),i("Input",{staticClass:"searchBox1",staticStyle:{width:"200px"},attrs:{placeholder:"乘车人"},model:{value:t.book_name,callback:function(e){t.book_name=e},expression:"book_name"}})],1),t._v(" "),i("div",{staticClass:"btnBox searchBox1"},[i("Button",{attrs:{type:"primary"},on:{click:t.search}},[t._v("搜索")]),t._v(" "),i("Button",{attrs:{type:"error"},on:{click:t.clean}},[t._v("清空")])],1)]),t._v(" "),i("Table",{attrs:{border:"",columns:t.columns12,data:t.data6},scopedSlots:t._u([{key:"action",fn:function(e){e.row;var a=e.index;return[i("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(e){return t.show(a)}}},[t._v("详情")]),t._v(" "),i("Button",{attrs:{type:"error",size:"small"},on:{click:function(e){return t.remove(a)}}},[t._v("取消")])]}}])}),t._v(" "),i("div",{staticClass:"page_box"},[i("div",{staticClass:"page_left"},[t._v("\n      共"+t._s(t.total)+"条记录 第"+t._s(t.page)+"/"+t._s(Math.ceil(t.total/t.pagesize))+"页\n    ")]),t._v(" "),i("div",{staticClass:"page_right"},[i("Page",{attrs:{total:t.total,"page-size":t.pagesize,current:t.page},on:{"on-change":t.changePage}})],1)]),t._v(" "),i("Modal",{staticClass:"Modal",attrs:{title:"订单详情","ok-text":"关闭","cancel-text":"",width:"800"},model:{value:t.modal1,callback:function(e){t.modal1=e},expression:"modal1"}},[i("div",{staticClass:"ModalBox"},[i("div",{staticClass:"boxLine"},[i("div",{staticClass:"boxList"},[i("div",{staticClass:"listItem"},[i("div",{staticStyle:{"white-space":"nowrap"}},[t._v("订单号:")]),t._v(" "),i("div",[t._v(t._s(t.detailInfo.order_sn))])]),t._v(" "),i("div",{staticClass:"listItem"},[i("div",{staticStyle:{"white-space":"nowrap"}},[t._v("改签时间:")]),t._v(" "),i("div",[t._v(t._s(t.detailInfo.change_ticket_time||""))])]),t._v(" "),i("div",{staticClass:"listItem"},[i("div",{staticStyle:{"white-space":"nowrap"}},[t._v("订单创建时间:")]),t._v(" "),i("div",[t._v(t._s(t.detailInfo.created_at))])])]),t._v(" "),i("div",{staticClass:"boxList"},[i("div",{staticClass:"listItem"},[i("div",{staticStyle:{"white-space":"nowrap"}},[t._v("订单状态:")]),t._v(" "),i("div",[t._v(t._s(this.detailInfo.status))])]),t._v(" "),i("div",{staticClass:"listItem"},[i("div",{staticStyle:{"white-space":"nowrap"}},[t._v("取消时间:")]),t._v(" "),i("div",[t._v(t._s(t.detailInfo.cancel_time||t.detailInfo.refund_time||""))])])]),t._v(" "),i("div",{staticClass:"boxList"},[i("div",{staticClass:"listItem"},[i("div",{staticStyle:{"white-space":"nowrap"}},[t._v("支付状态:")]),t._v(" "),i("div",[t._v(t._s(t.detailInfo.orderType))])]),t._v(" "),i("div",{staticClass:"listItem"},[i("div",{staticStyle:{"white-space":"nowrap"}},[t._v("取消原因:")]),t._v(" "),i("div",[t._v(t._s(t.detailInfo.cancel_reason))])])])])]),t._v(" "),i("div",{staticClass:"ModalBox"},[i("div",{staticClass:"boxLine"},[i("div",{staticClass:"boxList"},[i("div",{staticClass:"listItem"},[i("div",{staticStyle:{"white-space":"nowrap"}},[t._v("路线:")]),t._v(" "),i("div",[t._v(t._s(t.detailInfo.from)+"-"+t._s(t.detailInfo.to))])]),t._v(" "),i("div",{staticClass:"listItem"},[i("div",{staticStyle:{"white-space":"nowrap"}},[t._v("预定人:")]),t._v(" "),i("div",[t._v(t._s(t.detailInfo.name))])]),t._v(" "),i("div",{staticClass:"listItem"},[i("div",{staticStyle:{"white-space":"nowrap"}},[t._v("司机:")]),t._v(" "),i("div",[t._v(t._s(t.detailInfo.driver_name))])]),t._v(" "),i("div",{staticClass:"listItem"},[i("div",{staticStyle:{"white-space":"nowrap"}},[t._v("上车地点:")]),t._v(" "),i("div",[t._v(t._s(t.detailInfo.start_name))])])]),t._v(" "),i("div",{staticClass:"boxList"},[i("div",{staticClass:"listItem"},[i("div",{staticStyle:{"white-space":"nowrap"}},[t._v("发车时间:")]),t._v(" "),i("div",[t._v(t._s(t.detailInfo.ticket_time))])]),t._v(" "),i("div",{staticClass:"listItem"},[i("div",{staticStyle:{"white-space":"nowrap"}},[t._v("电话:")]),t._v(" "),i("div",[t._v(t._s(t.detailInfo.phone))])]),t._v(" "),t.detailInfo.user?i("div",{staticClass:"listItem"},[i("div",{staticStyle:{"white-space":"nowrap"}},[t._v("身份证号码:")]),t._v(" "),i("div",[t._v(t._s(t.detailInfo.user.id_card_number))])]):t._e(),t._v(" "),i("div",{staticClass:"listItem"},[i("div",{staticStyle:{"white-space":"nowrap"}},[t._v("车牌号:")]),t._v(" "),i("div",[t._v(t._s(t.detailInfo.car_no))])]),t._v(" "),i("div",{staticClass:"listItem"},[i("div",{staticStyle:{"white-space":"nowrap"}},[t._v("下车地点:")]),t._v(" "),i("div",[t._v(t._s(t.detailInfo.end_name))])])]),t._v(" "),i("div",{staticClass:"boxList"},[i("div",{staticClass:"listItem"},[i("div",{staticStyle:{"white-space":"nowrap"}},[t._v("预计接人时间:")]),t._v(" "),i("div",[t._v(t._s(t.detailInfo.pick_up_time))])]),t._v(" "),i("div",{staticClass:"listItem"},[i("div",{staticStyle:{"white-space":"nowrap"}},[t._v("乘车人数:")]),t._v(" "),i("div",[t._v(t._s(t.detailInfo.adult_numbers)+"人")])]),t._v(" "),i("div",{staticClass:"listItem"},[i("div",{staticStyle:{"white-space":"nowrap"}},[t._v("备注:")]),t._v(" "),i("div",[t._v(t._s(t.detailInfo.remark))])]),t._v(" "),i("div",{staticClass:"listItem"},[i("div",{staticStyle:{"white-space":"nowrap"}},[t._v("代金券:")]),t._v(" "),i("div",[t._v(t._s(t.detailInfo.coupon_money/100)+"元代金券")])])])])]),t._v(" "),i("div",{staticClass:"ModalBox"},[i("Table",{attrs:{columns:t.columns15,data:t.data11,border:""}})],1)]),t._v(" "),i("Button",{staticClass:"submitExcel",on:{click:t.subExcel}},[t._v("导出Excel")])],1)},staticRenderFns:[]};var l=i("VU/8")(r,d,!1,function(t){i("cp6T")},"data-v-f4e68704",null);e.default=l.exports},cp6T:function(t,e){}});
//# sourceMappingURL=14.0df60dcc61db5e031650.js.map